<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating XML-RPC Servers and Clients with Twisted &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Twisted Web In 60 Seconds" href="web-in-60/index.html" />
    <link rel="prev" title="HTML Templating with twisted.web.template" href="twisted-templates.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Web</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="web-overview.html">Overview of Twisted Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="using-twistedweb.html">Configuring and Using the Twisted Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="web-development.html">Web Application Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="twisted-templates.html">HTML Templating with twisted.web.template</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Creating XML-RPC Servers and Clients with Twisted</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-xml-rpc-server">Creating a XML-RPC server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#soap-support">SOAP Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-an-xml-rpc-client">Creating an XML-RPC Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging-with-an-xml-rpc-client">Debugging with an XML-RPC client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#serving-soap-and-xml-rpc-simultaneously">Serving SOAP and XML-RPC simultaneously</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="web-in-60/index.html">Twisted Web In 60 Seconds</a></li>
<li class="toctree-l3"><a class="reference internal" href="resource-templates.html">Light Weight Templating With Resource Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="client.html">Using the Twisted Web Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Web</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>Creating XML-RPC Servers and Clients with Twisted</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/web/howto/xmlrpc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-xml-rpc-servers-and-clients-with-twisted">
<h1>Creating XML-RPC Servers and Clients with Twisted<a class="headerlink" href="#creating-xml-rpc-servers-and-clients-with-twisted" title="Permalink to this headline"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="http://www.xmlrpc.com">XML-RPC</a> is a simple request/reply protocol
that runs over HTTP. It is simple, easy to implement and supported by most programming
languages. Twisted’s XML-RPC support is implemented using the`xmlrpclib &lt;<a class="reference external" href="http://docs.python.org/library/xmlrpclib.html">http://docs.python.org/library/xmlrpclib.html</a>&gt;`_ library that is
included with Python 2.2 and later.</p>
</section>
<section id="creating-a-xml-rpc-server">
<h2>Creating a XML-RPC server<a class="headerlink" href="#creating-a-xml-rpc-server" title="Permalink to this headline"></a></h2>
<p>Making a server is very easy - all you need to do is inherit from <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.web.xmlrpc.XMLRPC</span></code> .
You then create methods beginning with <code class="docutils literal notranslate"><span class="pre">xmlrpc_</span></code> . The methods’
arguments determine what arguments it will accept from XML-RPC clients.
The result is what will be returned to the clients.</p>
<p>Methods published via XML-RPC can return all the basic XML-RPC
types, such as strings, lists and so on (just return a regular python
integer, etc).  They can also raise exceptions or return Failure instances to indicate an
error has occurred, or <code class="docutils literal notranslate"><span class="pre">Binary</span></code> , <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> or <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>
instances (all of these are the same as the respective classes in xmlrpclib. In
addition, XML-RPC published methods can return <code class="xref py py-class docutils literal notranslate"><span class="pre">Deferred</span></code> instances whose results are one of the above. This allows
you to return results that can’t be calculated immediately, such as database queries.
See the <a class="reference internal" href="../../core/howto/defer.html"><span class="doc">Deferred documentation</span></a> for more
details.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">XMLRPC</span></code> instances
are Resource objects, and they can thus be published using a Site. The
following example has two methods published via XML-RPC, <code class="docutils literal notranslate"><span class="pre">add(a,</span> <span class="pre">b)</span></code> and <code class="docutils literal notranslate"><span class="pre">echo(x)</span></code> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">xmlrpc</span><span class="p">,</span> <span class="n">server</span>

<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An example object to be published.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">xmlrpc_echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all passed args.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">xmlrpc_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return sum of arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">xmlrpc_fault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise a Fault indicating that the procedure should not be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">Fault</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="s2">&quot;The fault procedure is faulty.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">endpoints</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">7080</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>After we run this command, we can connect with a client and send commands
to the server:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">xmlrpclib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="s1">&#39;http://localhost:7080/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;lala&quot;</span><span class="p">)</span>
<span class="go">&#39;lala&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fault</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">xmlrpclib.Fault</span>: <span class="n">&lt;Fault 123: &#39;The fault procedure is faulty.&#39;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If the <code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code> object is
needed by an <code class="docutils literal notranslate"><span class="pre">xmlrpc_*</span></code> method, it can be made available using
the <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.web.xmlrpc.withRequest()</span></code> decorator.  When
using this decorator, the method will be passed the request object as the first
argument, before any XML-RPC parameters.  For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.xmlrpc</span> <span class="kn">import</span> <span class="n">XMLRPC</span><span class="p">,</span> <span class="n">withRequest</span>
<span class="kn">from</span> <span class="nn">twisted.web.server</span> <span class="kn">import</span> <span class="n">Site</span>

<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="nd">@withRequest</span>
    <span class="k">def</span> <span class="nf">xmlrpc_headerValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">headerName</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">requestHeaders</span><span class="o">.</span><span class="n">getRawHeaders</span><span class="p">(</span><span class="n">headerName</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">endpoints</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">7080</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Site</span><span class="p">(</span><span class="n">Example</span><span class="p">()))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>XML-RPC resources can also be part of a normal Twisted web server, using
resource scripts. The following is an example of such a resource script:</p>
<p><a class="reference download internal" download="" href="../../_downloads/fed1b0cf0cb7cbefa8aa073f0375c88c/xmlquote.rpy"><code class="xref download docutils literal notranslate"><span class="pre">xmlquote.rpy</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">xmlrpc</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">getQuote</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;What are you talking about, William?&quot;</span>

<span class="k">class</span> <span class="nc">Quoter</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">xmlrpc_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">getQuote</span><span class="p">()</span>
    
<span class="n">resource</span> <span class="o">=</span> <span class="n">Quoter</span><span class="p">()</span>
</pre></div>
</div>
<section id="using-xml-rpc-sub-handlers">
<h3>Using XML-RPC sub-handlers<a class="headerlink" href="#using-xml-rpc-sub-handlers" title="Permalink to this headline"></a></h3>
<p>XML-RPC resource can be nested so that one handler calls another if
a method with a given prefix is called. For example, to add support
for an XML-RPC method <code class="docutils literal notranslate"><span class="pre">date.time()</span></code> to
the <code class="docutils literal notranslate"><span class="pre">Example</span></code> class, you could do the
following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">xmlrpc</span><span class="p">,</span> <span class="n">server</span>

<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An example object to be published.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">xmlrpc_echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all passed args.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">xmlrpc_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return sum of arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">class</span> <span class="nc">Date</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serve the XML-RPC &#39;time&#39; method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">xmlrpc_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return UNIX time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">endpoints</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">Date</span><span class="p">()</span>
    <span class="n">r</span><span class="o">.</span><span class="n">putSubHandler</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">7080</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, a period (‘.’) separates the prefix from the method
name, but you can use a different character by overriding the <code class="docutils literal notranslate"><span class="pre">XMLRPC.separator</span></code> data member in your base
XML-RPC server. XML-RPC servers may be nested to arbitrary depths
using this method.</p>
</section>
<section id="using-your-own-procedure-getter">
<h3>Using your own procedure getter<a class="headerlink" href="#using-your-own-procedure-getter" title="Permalink to this headline"></a></h3>
<p>Sometimes, you want to implement your own policy of getting the end implementation.
E.g. just like sub-handlers you want to divide the implementations into separate classes but
may not want to introduce <code class="docutils literal notranslate"><span class="pre">XMLRPC.separator</span></code> in the procedure name.
In such cases just override the <code class="docutils literal notranslate"><span class="pre">lookupProcedure(self,</span> <span class="pre">procedurePath)</span></code>
method and return the correct callable.
Raise <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.web.xmlrpc.NoSuchFunction</span></code> otherwise.</p>
<p><a class="reference download internal" download="" href="../../_downloads/ef6810771de96d40275a9ea7dde6a1fc/xmlrpc-customized.py"><code class="xref download docutils literal notranslate"><span class="pre">xmlrpc-customized.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">endpoints</span>
<span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">server</span><span class="p">,</span> <span class="n">xmlrpc</span>


<span class="k">class</span> <span class="nc">EchoHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all passed args</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">class</span> <span class="nc">AddHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return sum of arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An example of using you own policy to fetch the handler</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addHandler</span> <span class="o">=</span> <span class="n">AddHandler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_echoHandler</span> <span class="o">=</span> <span class="n">EchoHandler</span><span class="p">()</span>

        <span class="c1"># We keep a dict of all relevant</span>
        <span class="c1"># procedure names and callable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_procedureToCallable</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addHandler</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
            <span class="s2">&quot;echo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoHandler</span><span class="o">.</span><span class="n">echo</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">lookupProcedure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">procedurePath</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_procedureToCallable</span><span class="p">[</span><span class="n">procedurePath</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">NoSuchFunction</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">,</span> <span class="s2">&quot;procedure </span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">procedurePath</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">listProcedures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Since we override lookupProcedure, its suggested to override</span>
<span class="sd">        listProcedures too.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;echo&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">7080</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="adding-xml-rpc-introspection-support">
<h3>Adding XML-RPC Introspection support<a class="headerlink" href="#adding-xml-rpc-introspection-support" title="Permalink to this headline"></a></h3>
<p>XML-RPC has an
informal <a class="reference external" href="http://tldp.org/HOWTO/XML-RPC-HOWTO/xmlrpc-howto-interfaces.html">IntrospectionAPI</a> that specifies three methods in a <code class="docutils literal notranslate"><span class="pre">system</span></code>
sub-handler which allow a client to query a server about the server’s
API. Adding Introspection support to
the <code class="docutils literal notranslate"><span class="pre">Example</span></code> class is easy using
the <code class="xref py py-class docutils literal notranslate"><span class="pre">XMLRPCIntrospection</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">xmlrpc</span><span class="p">,</span> <span class="n">server</span>

<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An example object to be published.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">xmlrpc_echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all passed args.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="n">xmlrpc_echo</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="s1">&#39;struct&#39;</span><span class="p">,</span> <span class="s1">&#39;struct&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">xmlrpc_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return sum of arguments.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="n">xmlrpc_add</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">]]</span>
    <span class="n">xmlrpc_add</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Add the arguments and return the sum.&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">endpoints</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>
    <span class="n">xmlrpc</span><span class="o">.</span><span class="n">addIntrospection</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">7080</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Note the method attributes <code class="docutils literal notranslate"><span class="pre">help</span></code>
and <code class="docutils literal notranslate"><span class="pre">signature</span></code> which are used by the
Introspection API methods <code class="docutils literal notranslate"><span class="pre">system.methodHelp</span></code>
and <code class="docutils literal notranslate"><span class="pre">system.methodSignature</span></code> respectively. If
no <code class="docutils literal notranslate"><span class="pre">help</span></code> attribute is specified, the
method’s documentation string is used instead.</p>
</section>
</section>
<section id="soap-support">
<h2>SOAP Support<a class="headerlink" href="#soap-support" title="Permalink to this headline"></a></h2>
<p>From the point of view of a Twisted developer, there is little difference
between XML-RPC support and SOAP support. Here is an example of SOAP usage:</p>
<p><a class="reference download internal" download="" href="../../_downloads/d348dc9574db3c229e520f08efd26243/soap.rpy"><code class="xref download docutils literal notranslate"><span class="pre">soap.rpy</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">soap</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">getQuote</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;That beverage, sir, is off the hizzy.&quot;</span>

<span class="k">class</span> <span class="nc">Quoter</span><span class="p">(</span><span class="n">soap</span><span class="o">.</span><span class="n">SOAPPublisher</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Publish one method, &#39;quote&#39;.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">soap_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">getQuote</span><span class="p">()</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">Quoter</span><span class="p">()</span>                 
</pre></div>
</div>
</section>
<section id="creating-an-xml-rpc-client">
<h2>Creating an XML-RPC Client<a class="headerlink" href="#creating-an-xml-rpc-client" title="Permalink to this headline"></a></h2>
<p>XML-RPC clients in Twisted are meant to look as something which will be
familiar either to <code class="docutils literal notranslate"><span class="pre">xmlrpclib</span></code> or to Perspective Broker users,
taking features from both, as appropriate. There are two major deviations
from the <code class="docutils literal notranslate"><span class="pre">xmlrpclib</span></code> way which should be noted:</p>
<ol class="arabic simple">
<li><p>No implicit <code class="docutils literal notranslate"><span class="pre">/RPC2</span></code> . If the services uses this path for the
XML-RPC calls, then it will have to be given explicitly.</p></li>
<li><p>No magic <code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> : calls must be made by an explicit
<code class="docutils literal notranslate"><span class="pre">callRemote</span></code> .</p></li>
</ol>
<p>The interface Twisted presents to XML-RPC client is that of a proxy
object: <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.web.xmlrpc.Proxy</span></code> . The
constructor for the object receives a URL: it must be an HTTP or HTTPS
URL. When an XML-RPC service is described, the URL to that service
will be given there.</p>
<p>Having a proxy object, one can just call the <code class="docutils literal notranslate"><span class="pre">callRemote</span></code> method,
which accepts a method name and a variable argument list (but no named
arguments, as these are not supported by XML-RPC). It returns a deferred,
which will be called back with the result. If there is any error, at any
level, the errback will be called. The exception will be the relevant Twisted
error in the case of a problem with the underlying connection (for example,
a timeout), <code class="docutils literal notranslate"><span class="pre">IOError</span></code> containing the status and message in the case
of a non-200 status or a <code class="docutils literal notranslate"><span class="pre">xmlrpclib.Fault</span></code> in the case of an
XML-RPC level problem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.xmlrpc</span> <span class="kn">import</span> <span class="n">Proxy</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="k">def</span> <span class="nf">printValue</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">printError</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="s1">&#39;http://advogato.org/XMLRPC&#39;</span><span class="p">)</span>
<span class="n">proxy</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s1">&#39;test.sumprod&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">addCallbacks</span><span class="p">(</span><span class="n">printValue</span><span class="p">,</span> <span class="n">printError</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="debugging-with-an-xml-rpc-client">
<h2>Debugging with an XML-RPC client<a class="headerlink" href="#debugging-with-an-xml-rpc-client" title="Permalink to this headline"></a></h2>
<p>Sometimes an XML-RPC server may send non-standard XML-RPC responses to your
client. In those cases, you can access the raw XML-RPC responses from the
server with <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.web.xmlrpc</span></code>’s <code class="docutils literal notranslate"><span class="pre">QueryFactory</span></code>.</p>
<p>You can simply log the response content strings for debugging, or implement
your own custom XML-RPC marshaller to handle the non-standard XML-RPC
responses.</p>
<p>An example Twisted application that does this can be found in
<code class="docutils literal notranslate"><span class="pre">docs/web/examples/xmlrpc-debug.py</span></code> .</p>
</section>
<section id="serving-soap-and-xml-rpc-simultaneously">
<h2>Serving SOAP and XML-RPC simultaneously<a class="headerlink" href="#serving-soap-and-xml-rpc-simultaneously" title="Permalink to this headline"></a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.web.xmlrpc.XMLRPC</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.web.soap.SOAPPublisher</span></code> are both <code class="xref py py-class docutils literal notranslate"><span class="pre">Resource</span></code> s.  So, to serve both XML-RPC and
SOAP in the one web server, you can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">putChild</span></code> method of Resource.</p>
<p>The following example uses an empty <code class="xref py py-class docutils literal notranslate"><span class="pre">resource.Resource</span></code> as the root resource for
a <code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code> , and then
adds <code class="docutils literal notranslate"><span class="pre">/RPC2</span></code> and <code class="docutils literal notranslate"><span class="pre">/SOAP</span></code> paths to it.</p>
<p><a class="reference download internal" download="" href="../../_downloads/33b439ceb45d9fb0bb748c45379244d0/xmlAndSoapQuote.py"><code class="xref download docutils literal notranslate"><span class="pre">xmlAndSoapQuote.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">endpoints</span>
<span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">resource</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">soap</span><span class="p">,</span> <span class="n">xmlrpc</span>


<span class="k">def</span> <span class="nf">getQuote</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Victory to the burgeois, you capitalist swine!&quot;</span>


<span class="k">class</span> <span class="nc">XMLRPCQuoter</span><span class="p">(</span><span class="n">xmlrpc</span><span class="o">.</span><span class="n">XMLRPC</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">xmlrpc_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">getQuote</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SOAPQuoter</span><span class="p">(</span><span class="n">soap</span><span class="o">.</span><span class="n">SOAPPublisher</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">soap_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">getQuote</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="p">()</span>
    <span class="n">root</span><span class="o">.</span><span class="n">putChild</span><span class="p">(</span><span class="s2">&quot;RPC2&quot;</span><span class="p">,</span> <span class="n">XMLRPCQuoter</span><span class="p">())</span>
    <span class="n">root</span><span class="o">.</span><span class="n">putChild</span><span class="p">(</span><span class="s2">&quot;SOAP&quot;</span><span class="p">,</span> <span class="n">SOAPQuoter</span><span class="p">())</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">7080</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Refer to <a class="reference internal" href="using-twistedweb.html#web-howto-using-twistedweb-development"><span class="std std-ref">Twisted Web
Development</span></a> for more details about Resources.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="twisted-templates.html" class="btn btn-neutral float-left" title="HTML Templating with twisted.web.template" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="web-in-60/index.html" class="btn btn-neutral float-right" title="Twisted Web In 60 Seconds" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>