<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Access Logging &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="WSGI" href="wsgi.html" />
    <link rel="prev" title="Logging Errors" href="logging-errors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Twisted Web</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../web-overview.html">Overview of Twisted Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using-twistedweb.html">Configuring and Using the Twisted Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../web-development.html">Web Application Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../twisted-templates.html">HTML Templating with twisted.web.template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xmlrpc.html">Creating XML-RPC Servers and Clients with Twisted</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Twisted Web In 60 Seconds</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="static-content.html">Serving Static Content From a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic-content.html">Generating a Page Dynamically</a></li>
<li class="toctree-l4"><a class="reference internal" href="static-dispatch.html">Static URL Dispatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic-dispatch.html">Dynamic URL Dispatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom-codes.html">Custom Response Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="handling-posts.html">Handling POSTs</a></li>
<li class="toctree-l4"><a class="reference internal" href="other-request-bodies.html">Other Request Bodies</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpy-scripts.html">rpy scripts (or, how to save yourself some typing)</a></li>
<li class="toctree-l4"><a class="reference internal" href="asynchronous.html">Asynchronous Responses</a></li>
<li class="toctree-l4"><a class="reference internal" href="asynchronous-deferred.html">Asynchronous Responses (via Deferred)</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupted.html">Interrupted Responses</a></li>
<li class="toctree-l4"><a class="reference internal" href="logging-errors.html">Logging Errors</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Access Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="wsgi.html">WSGI</a></li>
<li class="toctree-l4"><a class="reference internal" href="http-auth.html">HTTP Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="session-basics.html">Session Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="session-store.html">Storing Objects in the Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="session-endings.html">Session Endings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../resource-templates.html">Light Weight Templating With Resource Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client.html">Using the Twisted Web Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Twisted Web</a> &raquo;</li>
          <li><a href="../index.html">Developer Guides</a> &raquo;</li>
          <li><a href="index.html">Twisted Web In 60 Seconds</a> &raquo;</li>
      <li>Access Logging</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/web/howto/web-in-60/access-logging.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="access-logging">
<h1>Access Logging<a class="headerlink" href="#access-logging" title="Permalink to this headline"></a></h1>
<p>As long as we’re on the topic of <a class="reference internal" href="logging-errors.html"><span class="doc">logging</span></a>, this is probably a good time to mention Twisted Web’s access log support.
In this example, we’ll see what Twisted Web logs for each request it processes and how this can be customized.</p>
<p>If you’ve run any of the previous examples and watched the output of <code class="docutils literal notranslate"><span class="pre">twistd</span></code> or read <code class="docutils literal notranslate"><span class="pre">twistd.log</span></code> then you’ve already seen some log lines like this:</p>
<blockquote>
<div><p>2014-01-29 17:50:50-0500 [HTTPChannel,0,127.0.0.1] “127.0.0.1” - - [29/Jan/2014:22:50:50 +0000] “GET / HTTP/1.1” 200 2753 “-” “Mozilla/5.0 …”</p>
</div></blockquote>
<p>If you focus on the latter portion of this log message you’ll see something that looks like a standard “combined log format” message.
However, it’s prefixed with the normal Twisted logging prefix giving a timestamp and some protocol and peer addressing information.
Much of this information is redundant since it is part of the combined log format.
<code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code> lets you produce a more compact log which omits the normal Twisted logging prefix.
To take advantage of this feature all that is necessary is to tell <code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code> where to write this compact log.
Do this by passing <code class="docutils literal notranslate"><span class="pre">logPath</span></code> to the initializer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">Site</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">logPath</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/tmp/access-logging-demo.log&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if you want to change the logging behavior of a server you’re launching with <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">web</span></code> then just pass the <code class="docutils literal notranslate"><span class="pre">--logfile</span></code> option:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ twistd -n web --logfile /tmp/access-logging-demo.log
</pre></div>
</div>
<p>Apart from this, the rest of the server setup is the same.
Once you pass <code class="docutils literal notranslate"><span class="pre">logPath</span></code> or use <code class="docutils literal notranslate"><span class="pre">--logfile</span></code> on the command line the server will produce a log file containing lines like:</p>
<blockquote>
<div><p>“127.0.0.1” - - [30/Jan/2014:00:13:35 +0000] “GET / HTTP/1.1” 200 2753 “-” “Mozilla/5.0 …”</p>
</div></blockquote>
<p>Any tools expecting combined log format messages should be able to work with these log files.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code> also allows the log format used to be customized using its <code class="docutils literal notranslate"><span class="pre">logFormatter</span></code> argument.
Twisted Web comes with one alternate formatter, <code class="xref py py-func docutils literal notranslate"><span class="pre">proxiedLogFormatter</span></code>, which is for use behind a proxy that sets the <code class="docutils literal notranslate"><span class="pre">X-Forwarded-For</span></code> header.
It logs the client address taken from this header rather than the network address of the client directly connected to the server.
Here’s the complete code for an example that uses both these features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.http</span> <span class="kn">import</span> <span class="n">proxiedLogFormatter</span>
<span class="kn">from</span> <span class="nn">twisted.web.server</span> <span class="kn">import</span> <span class="n">Site</span>
<span class="kn">from</span> <span class="nn">twisted.web.static</span> <span class="kn">import</span> <span class="n">File</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">endpoints</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">Site</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">logPath</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/tmp/access-logging-demo.log&quot;</span><span class="p">,</span> <span class="n">logFormatter</span><span class="o">=</span><span class="n">proxiedLogFormatter</span><span class="p">)</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
<span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="logging-errors.html" class="btn btn-neutral float-left" title="Logging Errors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="wsgi.html" class="btn btn-neutral float-right" title="WSGI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>