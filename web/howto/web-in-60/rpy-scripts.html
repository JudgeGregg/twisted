<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rpy scripts (or, how to save yourself some typing) &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Asynchronous Responses" href="asynchronous.html" />
    <link rel="prev" title="Other Request Bodies" href="other-request-bodies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Twisted Web</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../web-overview.html">Overview of Twisted Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using-twistedweb.html">Configuring and Using the Twisted Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../web-development.html">Web Application Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../twisted-templates.html">HTML Templating with twisted.web.template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xmlrpc.html">Creating XML-RPC Servers and Clients with Twisted</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Twisted Web In 60 Seconds</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="static-content.html">Serving Static Content From a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic-content.html">Generating a Page Dynamically</a></li>
<li class="toctree-l4"><a class="reference internal" href="static-dispatch.html">Static URL Dispatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic-dispatch.html">Dynamic URL Dispatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom-codes.html">Custom Response Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="handling-posts.html">Handling POSTs</a></li>
<li class="toctree-l4"><a class="reference internal" href="other-request-bodies.html">Other Request Bodies</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">rpy scripts (or, how to save yourself some typing)</a></li>
<li class="toctree-l4"><a class="reference internal" href="asynchronous.html">Asynchronous Responses</a></li>
<li class="toctree-l4"><a class="reference internal" href="asynchronous-deferred.html">Asynchronous Responses (via Deferred)</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupted.html">Interrupted Responses</a></li>
<li class="toctree-l4"><a class="reference internal" href="logging-errors.html">Logging Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="access-logging.html">Access Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="wsgi.html">WSGI</a></li>
<li class="toctree-l4"><a class="reference internal" href="http-auth.html">HTTP Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="session-basics.html">Session Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="session-store.html">Storing Objects in the Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="session-endings.html">Session Endings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../resource-templates.html">Light Weight Templating With Resource Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client.html">Using the Twisted Web Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Twisted Web</a> &raquo;</li>
          <li><a href="../index.html">Developer Guides</a> &raquo;</li>
          <li><a href="index.html">Twisted Web In 60 Seconds</a> &raquo;</li>
      <li>rpy scripts (or, how to save yourself some typing)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/web/howto/web-in-60/rpy-scripts.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rpy-scripts-or-how-to-save-yourself-some-typing">
<h1>rpy scripts (or, how to save yourself some typing)<a class="headerlink" href="#rpy-scripts-or-how-to-save-yourself-some-typing" title="Permalink to this headline"></a></h1>
<p>The goal of this installment is to show you another way to run a Twisted Web
server with a custom resource which doesn’t require as much code as the previous
examples.</p>
<p>The feature in question is called an <code class="docutils literal notranslate"><span class="pre">rpy</span> <span class="pre">script</span></code> . An rpy script
is a Python source file which defines a resource and can be loaded into a
Twisted Web server. The advantages of this approach are that you don’t have to
write code to create the site or set up a listening port with the reactor. That
means fewer lines of code that aren’t dedicated to the task you’re trying to
accomplish.</p>
<p>There are some disadvantages, though. An rpy script must have the
extension <code class="docutils literal notranslate"><span class="pre">.rpy</span></code> . This means you can’t import it using the
usual Python import statement. This means it’s hard to re-use code in
an rpy script. This also means you can’t easily unit test it. The code
in an rpy script is evaluated in an unusual context. So, while rpy
scripts may be useful for testing out ideas, they’re not recommend for
much more than that.</p>
<p>Okay, with that warning out of the way, let’s dive in. First, as mentioned,
rpy scripts are Python source files with the <code class="docutils literal notranslate"><span class="pre">.rpy</span></code> extension. So,
open up an appropriately named file (for example, <code class="docutils literal notranslate"><span class="pre">example.rpy</span></code> ) and
put this code in it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">twisted.web.resource</span> <span class="kn">import</span> <span class="n">Resource</span>


<span class="k">class</span> <span class="nc">ClockPage</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="n">isLeaf</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="nf">render_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&#39;utf-8&#39;&gt;&quot;</span>
                <span class="sa">b</span><span class="s2">&quot;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">ClockPage</span><span class="p">()</span>
</pre></div>
</div>
<p>You may recognize this as the resource from
the <a class="reference internal" href="dynamic-content.html"><span class="doc">first dynamic rendering example</span></a> . What’s different is what you don’t see: we didn’t
import <code class="docutils literal notranslate"><span class="pre">reactor</span></code> or <code class="docutils literal notranslate"><span class="pre">Site</span></code> . There are no calls
to <code class="docutils literal notranslate"><span class="pre">endpoints.TCP4ServerEndpoint</span></code> or <code class="docutils literal notranslate"><span class="pre">run</span></code> . Instead, and this is
the core idea for rpy scripts, we just bound the
name <code class="docutils literal notranslate"><span class="pre">resource</span></code> to the resource we want the script to
serve. Every rpy script must bind this name, and this name is the only
thing Twisted Web will pay attention to in an rpy script.</p>
<p>All that’s left is to drop this rpy script into a Twisted Web server. There
are a few ways to do this. The simplest way is with <code class="docutils literal notranslate"><span class="pre">twistd</span></code> :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>twistd -n web --path .
</pre></div>
</div>
<p>Hit <a class="reference external" href="http://localhost:8080/example.rpy">http://localhost:8080/example.rpy</a>
to see it run. You can pass other arguments here too. <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">web</span></code>
has options for specifying which port number to bind, whether to set up an HTTPS
server, and plenty more. Other options you can pass to <code class="docutils literal notranslate"><span class="pre">twistd</span></code> allow
you to configure logging to work differently, to select a different reactor,
etc. For a full list of options, see <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">--help</span></code> and <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">web</span> <span class="pre">--help</span></code> .</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="other-request-bodies.html" class="btn btn-neutral float-left" title="Other Request Bodies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="asynchronous.html" class="btn btn-neutral float-right" title="Asynchronous Responses" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>