<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Twisted Pair: Tunnels And Network Taps &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Twisted Pair: Device Configuration" href="configuration.html" />
    <link rel="prev" title="Developer Guides" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Pair</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Twisted Pair: Tunnels And Network Taps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tuntap-ports">Tuntap Ports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Twisted Pair: Device Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Pair</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>Twisted Pair: Tunnels And Network Taps</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pair/howto/tunnels.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="twisted-pair-tunnels-and-network-taps">
<h1>Twisted Pair: Tunnels And Network Taps<a class="headerlink" href="#twisted-pair-tunnels-and-network-taps" title="Permalink to this heading"></a></h1>
<p>On Linux, Twisted Pair supports the special <em>tun</em> and <em>tap</em> network interface types.
This functionality allows you to interact with raw sockets (for example, to send or receive ICMP or ARP traffic).
It also allows the creation of simulated networks.
This document will not cover the details of these platform-provided features, but it will explain how to use the Twisted Pair APIs which interact with them.
Before reading this document, you may want to familiarize yourself with Linux tuntap if you have not already done so
(good online resources, are a little scarce, but you may find the <a class="reference external" href="https://www.google.com/search?q=linux+tuntap+tutorial">linux tuntap tutorial</a> google results helpful).</p>
<section id="tuntap-ports">
<h2>Tuntap Ports<a class="headerlink" href="#tuntap-ports" title="Permalink to this heading"></a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.pair.tuntap.TuntapPort</span></code> class is the entry point into the tun/tap functionality.
This class is initialized with an application-supplied protocol object and associates that object with a tun or tap device on the system.
If the protocol provides <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.pair.ethernet.IEthernetProtocol</span></code> then it is associated with a tap device.
Otherwise the protocol must provide <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.pair.raw.IRawPacketProtocol</span></code> and it will be associated with a tun device.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">twisted.pair.tuntap</span> <span class="kn">import</span> <span class="n">TuntapPort</span>
<span class="kn">from</span> <span class="nn">twisted.pair.ethernet</span> <span class="kn">import</span> <span class="n">EthernetProtocol</span>
<span class="kn">from</span> <span class="nn">twisted.pair.rawudp</span> <span class="kn">import</span> <span class="n">RawUDPProtocol</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="c1"># Note that you must run this example as a user with permission to open this</span>
<span class="c1"># device.  That means run it as root or pre-configure tap0 and assign ownership</span>
<span class="c1"># of it to a non-root user.  The same goes for tun0 below.</span>

<span class="n">tap</span> <span class="o">=</span> <span class="n">TuntapPort</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;tap0&quot;</span><span class="p">,</span> <span class="n">EthernetProtocol</span><span class="p">(),</span> <span class="n">reactor</span><span class="o">=</span><span class="n">reactor</span><span class="p">)</span>
<span class="n">tap</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>

<span class="n">tun</span> <span class="o">=</span> <span class="n">TuntapPort</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;tun0&quot;</span><span class="p">,</span> <span class="n">RawUDPProtocol</span><span class="p">(),</span> <span class="n">reactor</span><span class="o">=</span><span class="n">reactor</span><span class="p">)</span>
<span class="n">tun</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>
</pre></div>
</div>
<p>In the above example two protocols are attached to the network: one to a tap device and the other to a tun device.
The <code class="docutils literal notranslate"><span class="pre">EthernetProtocol</span></code> used in this example is a very simple implementation of <code class="docutils literal notranslate"><span class="pre">IEthernetProtocol</span></code> which does nothing more than dispatch to some other protocol based on the protocol found in the header of each ethernet frame it receives. <code class="docutils literal notranslate"><span class="pre">RawUDPProtocol</span></code> is similar - it dispatches to other protocols based on the UDP port of IP datagrams it received.
This example won’t do anything since no application protocols have been added to either the <code class="docutils literal notranslate"><span class="pre">EthernetProtocol</span></code> or <code class="docutils literal notranslate"><span class="pre">RawUDPProtocol</span></code> instances
(not to mention the reactor isn’t being started).
However, it should give you some idea of how tun/tap functionality fits into a Twisted application.</p>
<p>By the behaviors of these two protocols you can see the primary difference between tap and tun devices.
The lower level of the two, tap devices, is hooked in to the network stack at the ethernet layer.
When a <code class="docutils literal notranslate"><span class="pre">TuntapPort</span></code> is associated with a tap device, it delivers whole ethernet frames to its protocol.
The higher level version, tun devices, strips off the ethernet layer before delivering data to the application.
This means that a <code class="docutils literal notranslate"><span class="pre">TuntapPort</span></code> associated with a tun device most commonly delivers IP datagrams to its protocol (though if your network is being used to convey non-IP datagrams then it may deliver those instead).</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">IEthernetProtocol</span></code> and <code class="docutils literal notranslate"><span class="pre">IRawSocketProtocol</span></code> are similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.protocol.DatagramProtocol</span></code> .
Datagrams, either ethernet or otherwise, are delivered to the protocol’s <code class="docutils literal notranslate"><span class="pre">datagramReceived</span></code> method.
Conversely the protocol is associated with a transport with a <code class="docutils literal notranslate"><span class="pre">write</span></code> method that accepts datagrams for injection into the network.</p>
<p>You can see an example of some of this functionality in the <a class="reference download internal" download="" href="../../_downloads/a4b87e2df858b1bfdd2d8b2e6db1f67a/pairudp.py"><code class="xref download docutils literal notranslate"><span class="pre">../examples/pairudp.py</span></code></a> example.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Developer Guides" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configuration.html" class="btn btn-neutral float-right" title="Twisted Pair: Device Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-09.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>