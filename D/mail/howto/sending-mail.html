<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sending Mail &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Twisted Mail Tutorial: Building an SMTP Client from Scratch" href="../tutorial/smtpclient/smtpclient.html" />
    <link rel="prev" title="Developer Guides" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Mail (SMTP, POP, and IMAP)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Sending Mail</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sending-an-email-over-smtp">Sending an Email over SMTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sending-an-email-over-esmtp">Sending an Email over ESMTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sending-complex-emails">Sending Complex Emails</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enforcing-transport-security">Enforcing Transport Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/smtpclient/smtpclient.html">Twisted Mail Tutorial: Building an SMTP Client from Scratch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Mail (SMTP, POP, and IMAP)</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>Sending Mail</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/mail/howto/sending-mail.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sending-mail">
<h1>Sending Mail<a class="headerlink" href="#sending-mail" title="Permalink to this heading"></a></h1>
<p>Twisted contains many ways of sending email, but the simplest is <code class="xref py py-func docutils literal notranslate"><span class="pre">sendmail</span></code>.
Intended as a near drop-in replacement of <a class="reference external" href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">smtplib.SMTP</span></code></a>'s <code class="docutils literal notranslate"><span class="pre">sendmail</span></code> method, it provides the ability to send email over SMTP/ESMTP with minimal fuss or configuration.</p>
<p>Knowledge of Twisted’s Deferreds is required for making full use of this document.</p>
<section id="sending-an-email-over-smtp">
<h2>Sending an Email over SMTP<a class="headerlink" href="#sending-an-email-over-smtp" title="Permalink to this heading"></a></h2>
<p>Although insecure, some email systems still use plain SMTP for sending email.
Plain SMTP has no authentication, no transport security (emails are transmitted in plain text), and should not be done over untrusted networks.</p>
<p><code class="docutils literal notranslate"><span class="pre">sendmail</span></code>'s positional arguments are, in order:</p>
<ul class="simple">
<li><p>The SMTP/ESMTP server you are sending the message to</p></li>
<li><p>The email address you are sending from</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">list</span></code> of email addresses you are sending to</p></li>
<li><p>The message.</p></li>
</ul>
<p>The following example shows these in action.</p>
<p><a class="reference download internal" download="" href="../../_downloads/d13505db6eb8166aeecddc8bb6da7354/sendmail_smtp.py"><code class="xref download docutils literal notranslate"><span class="pre">sendmail_smtp.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.task</span> <span class="kn">import</span> <span class="n">react</span>
<span class="kn">from</span> <span class="nn">twisted.mail.smtp</span> <span class="kn">import</span> <span class="n">sendmail</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">sendmail</span><span class="p">(</span>
        <span class="s2">&quot;myinsecuremailserver.example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;bob@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;charlie@gmail.com&quot;</span><span class="p">],</span>
        <span class="s2">&quot;This is my super awesome email, sent with Twisted!&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">d</span><span class="o">.</span><span class="n">addBoth</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="n">react</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>Assuming that the values in it were replaced with real emails and a real SMTP server, it would send an email to the two addresses specified and print the return status.</p>
</section>
<section id="sending-an-email-over-esmtp">
<h2>Sending an Email over ESMTP<a class="headerlink" href="#sending-an-email-over-esmtp" title="Permalink to this heading"></a></h2>
<p>Extended SMTP (ESMTP) is an improved version of SMTP, and is used by most modern mail servers.
Unlike SMTP, ESMTP supports authentication and transport security (emails are encrypted in transit).
If you wish to send mail through services like GMail/Google Apps or Outlook.com/Office 365, you will have to use ESMTP.</p>
<p>Using ESMTP requires more options – usually the default port of 25 is not open, so you must find out your email provider’s TLS-enabled ESMTP port.
It also allows the use of authentication via a username and password.</p>
<p>The following example shows part of the ESMTP functionality of <code class="docutils literal notranslate"><span class="pre">sendmail</span></code>.</p>
<p><a class="reference download internal" download="" href="../../_downloads/15a6edc07935fa92683efdacb9296768/sendmail_gmail.py"><code class="xref download docutils literal notranslate"><span class="pre">sendmail_gmail.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.task</span> <span class="kn">import</span> <span class="n">react</span>
<span class="kn">from</span> <span class="nn">twisted.mail.smtp</span> <span class="kn">import</span> <span class="n">sendmail</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">sendmail</span><span class="p">(</span>
        <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;alice@gmail.com&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;bob@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;charlie@gmail.com&quot;</span><span class="p">],</span>
        <span class="s2">&quot;This is my super awesome email, sent with Twisted!&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="s2">&quot;alice@gmail.com&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;*********&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">d</span><span class="o">.</span><span class="n">addBoth</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="n">react</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>Assuming you own the account <code class="docutils literal notranslate"><span class="pre">alice&#64;gmail.com</span></code>, this would send an email to both <code class="docutils literal notranslate"><span class="pre">bob&#64;gmail.com</span></code> and <code class="docutils literal notranslate"><span class="pre">charlie&#64;gmail.com</span></code>, and print out something like the following (formatted for clarity):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;bob@gmail.com&#39;</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="s1">&#39;2.1.5 OK hz13sm11691456pac.6 - gsmtp&#39;</span><span class="p">),</span>
     <span class="p">(</span><span class="s1">&#39;charlie@gmail.com&#39;</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="s1">&#39;2.1.5 OK hz13sm11691456pac.6 - gsmtp&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sendmail</span></code> returns a 2-tuple, containing the number of emails sent successfully (note that this is from you to the server you specified, not to the recipient – emails may still be lost between that server and the recipient) and a list of statuses of the sent mail.
Each status is a 3-tuple containing the address it was sent to, the SMTP status code, and the server response.</p>
</section>
<section id="sending-complex-emails">
<h2>Sending Complex Emails<a class="headerlink" href="#sending-complex-emails" title="Permalink to this heading"></a></h2>
<p>Sometimes you want to send more complicated emails – ones with headers, or with attachments.
<code class="docutils literal notranslate"><span class="pre">sendmail</span></code> supports using Python’s <code class="xref py py-class docutils literal notranslate"><span class="pre">email.Message</span></code>, which lets you make complex emails:</p>
<p><a class="reference download internal" download="" href="../../_downloads/10d51475c856b6a30d1c76f132cb8368/sendmail_message.py"><code class="xref download docutils literal notranslate"><span class="pre">sendmail_message.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>

<span class="kn">from</span> <span class="nn">twisted.internet.task</span> <span class="kn">import</span> <span class="n">react</span>
<span class="kn">from</span> <span class="nn">twisted.mail.smtp</span> <span class="kn">import</span> <span class="n">sendmail</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">me</span> <span class="o">=</span> <span class="s2">&quot;alice@gmail.com&quot;</span>
    <span class="n">to</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bob@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;charlie@gmail.com&quot;</span><span class="p">]</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s2">&quot;This is my super awesome email, sent with Twisted!&quot;</span><span class="p">)</span>
    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Twisted is great!&quot;</span>
    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">me</span>
    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">sendmail</span><span class="p">(</span>
        <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
        <span class="n">me</span><span class="p">,</span>
        <span class="n">to</span><span class="p">,</span>
        <span class="n">message</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="n">me</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;*********&quot;</span><span class="p">,</span>
        <span class="n">requireAuthentication</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">requireTransportSecurity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">d</span><span class="o">.</span><span class="n">addBoth</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="n">react</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information on how to use <code class="docutils literal notranslate"><span class="pre">Message</span></code>, please see <a class="reference external" href="https://docs.python.org/3/library/email.examples.html#email-examples" title="(in Python v3.10)"><span class="xref std std-ref">the module’s Python docs</span></a>.</p>
</section>
<section id="enforcing-transport-security">
<h2>Enforcing Transport Security<a class="headerlink" href="#enforcing-transport-security" title="Permalink to this heading"></a></h2>
<p>To prevent downgrade attacks, you can pass <code class="docutils literal notranslate"><span class="pre">requireTransportSecurity=True</span></code> to <code class="docutils literal notranslate"><span class="pre">sendmail</span></code>.
This means that your emails will not be transmitted in plain text.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sendmail</span><span class="p">(</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span>
         <span class="n">port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;*********&quot;</span><span class="p">,</span>
         <span class="n">requireTransportSecurity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h2>
<p>In this document, you have seen how to:</p>
<ol class="arabic simple">
<li><p>Send an email over SMTP using <code class="xref py py-func docutils literal notranslate"><span class="pre">sendmail</span></code>.</p></li>
<li><p>Send an email over encrypted &amp; authenticated ESMTP with <code class="xref py py-func docutils literal notranslate"><span class="pre">sendmail</span></code>.</p></li>
<li><p>Send a “complex” email containing a subject line using the stdlib’s <code class="docutils literal notranslate"><span class="pre">email.Message</span></code> functionality.</p></li>
<li><p>Enforce transport security for emails sent using <code class="xref py py-func docutils literal notranslate"><span class="pre">sendmail</span></code>.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Developer Guides" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tutorial/smtpclient/smtpclient.html" class="btn btn-neutral float-right" title="Twisted Mail Tutorial: Building an SMTP Client from Scratch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-09.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>