<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generating Deferreds &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scheduling tasks for the future" href="time.html" />
    <link rel="prev" title="Deferred Reference" href="defer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vision.html">The Vision For Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="servers.html">Writing Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="clients.html">Writing Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="trial.html">Test-driven development with Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/index.html">Twisted from Scratch, or The Evolution of Finger</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/intro.html">The Evolution of Finger: building a simple finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/protocol.html">The Evolution of Finger: adding features to the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/style.html">The Evolution of Finger: cleaning up the finger code</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/components.html">The Evolution of Finger: moving to a component based architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/backends.html">The Evolution of Finger: pluggable backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/web.html">The Evolution of Finger: a web frontend</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/pb.html">The Evolution of Finger: Twisted client support using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/factory.html">The Evolution of Finger: using a single factory for multiple protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/client.html">The Evolution of Finger: a Twisted finger client</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/library.html">The Evolution of Finger: making a finger library</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/configuration.html">The Evolution of Finger: configuration of the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="quotes.html">Setting up the TwistedQuotes application</a></li>
<li class="toctree-l3"><a class="reference internal" href="design.html">Designing Twisted Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="internet-overview.html">Overview of Twisted Internet</a></li>
<li class="toctree-l3"><a class="reference internal" href="reactor-basics.html">Reactor Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl.html">Using TLS in Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="udp.html">UDP Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="process.html">Using Processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer-intro.html">Introduction to Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer.html">Deferred Reference</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generating Deferreds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#class-overview">Class overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-deferreds-don-t-do-make-your-code-asynchronous">What Deferreds don’t do: make your code asynchronous</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-processing-chain-control">Advanced Processing Chain Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#returning-deferreds-from-synchronous-functions">Returning Deferreds from synchronous functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integrating-blocking-code-with-twisted">Integrating blocking code with Twisted</a></li>
<li class="toctree-l4"><a class="reference internal" href="#possible-sources-of-error">Possible sources of error</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="time.html">Scheduling tasks for the future</a></li>
<li class="toctree-l3"><a class="reference internal" href="threading.html">Using Threads in Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="producers.html">Producers and Consumers: Efficient High-Volume Streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="choosing-reactor.html">Choosing a Reactor and GUI Toolkit Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="endpoints.html">Getting Connected with Endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="components.html">Components: Interfaces and Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cred.html">Cred: Pluggable Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin.html">The Twisted Plugin System</a></li>
<li class="toctree-l3"><a class="reference internal" href="basics.html">The Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="application.html">Using the Twisted Application Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="tap.html">Writing a twistd Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="systemd.html">Deploying Twisted with systemd</a></li>
<li class="toctree-l3"><a class="reference internal" href="logger.html">Logging with twisted.logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">Twisted’s Legacy Logging System: <code class="docutils literal notranslate"><span class="pre">twisted.python.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="constants.html">Symbolic Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="rdbms.html">twisted.enterprise.adbapi: Twisted RDBMS support</a></li>
<li class="toctree-l3"><a class="reference internal" href="options.html">Parsing command-lines with usage.Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="dirdbm.html">DirDBM: Directory-based Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Writing tests for Twisted code using Trial</a></li>
<li class="toctree-l3"><a class="reference internal" href="sendmsg.html">Extremely Low-Level Socket Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="amp.html">Asynchronous Messaging Protocol Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb.html">Overview of Twisted Spread</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-intro.html">Introduction to Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-usage.html">Using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-clients.html">Managing Clients of Perspectives</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-copyable.html">PB Copyable: Passing Complex Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-cred.html">Authentication with Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-limits.html">PB Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html">Porting to Python 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="positioning.html">Twisted Positioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Twisted Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="debug-with-emacs.html">Debugging Python(Twisted) with Emacs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specifications/index.html">Specifications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Core</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>Generating Deferreds</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/core/howto/gendefer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="generating-deferreds">
<h1>Generating Deferreds<a class="headerlink" href="#generating-deferreds" title="Permalink to this heading"></a></h1>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Deferred</span></code> objects are
signals that a function you have called does not yet have the data you want
available. When a function returns a Deferred object, your calling function
attaches callbacks to it to handle the data when available.</p>
<p>This document addresses the other half of the question: writing functions
that return Deferreds, that is, constructing Deferred objects, arranging for
them to be returned immediately without blocking until data is available, and
firing their callbacks when the data is available.</p>
<p>This document assumes that you are familiar with the asynchronous model used
by Twisted, and with <a class="reference internal" href="defer.html"><span class="doc">using deferreds returned by functions</span></a>
.</p>
<section id="class-overview">
<span id="core-howto-gendefer-class"></span><h2>Class overview<a class="headerlink" href="#class-overview" title="Permalink to this heading"></a></h2>
<p>This is an overview API reference for Deferred from the point of creating a
Deferred and firing its callbacks and errbacks.  It is not meant to be a
substitute for the docstrings in the Deferred class, but can provide
guidelines for its use.</p>
<p>There is a parallel overview of functions used by calling function which
the Deferred is returned to at <a class="reference internal" href="defer.html#core-howto-defer-class"><span class="std std-ref">Using Deferreds</span></a> .</p>
<section id="basic-callback-functions">
<h3>Basic Callback Functions<a class="headerlink" href="#basic-callback-functions" title="Permalink to this heading"></a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">callback(result)</span></code></p>
<p>Run success callbacks with the given result. <em>This can only be run once.</em> Later calls to this or
<code class="docutils literal notranslate"><span class="pre">errback</span></code> will raise <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.AlreadyCalledError</span></code> .
If further callbacks or errbacks are added after this
point, addCallbacks will run the callbacks immediately.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">errback(failure)</span></code></p>
<p>Run error callbacks with the given failure. <em>This can only be run once.</em> Later calls to this or
<code class="docutils literal notranslate"><span class="pre">callback</span></code> will raise <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.AlreadyCalledError</span></code> .
If further callbacks or errbacks are added after this
point, addCallbacks will run the callbacks immediately.</p>
</li>
</ul>
</section>
</section>
<section id="what-deferreds-don-t-do-make-your-code-asynchronous">
<h2>What Deferreds don’t do: make your code asynchronous<a class="headerlink" href="#what-deferreds-don-t-do-make-your-code-asynchronous" title="Permalink to this heading"></a></h2>
<p><em>Deferreds do not make the code magically not block.</em></p>
<p>Let’s take this function as an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>

<span class="n">TARGET</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="k">def</span> <span class="nf">largeFibonnaciNumber</span><span class="p">():</span>
    <span class="c1"># create a Deferred object to return:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>

    <span class="c1"># calculate the ten thousandth Fibonnaci number</span>

    <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">second</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TARGET</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">second</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">new</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Progress: calculating the </span><span class="si">%d</span><span class="s2">th Fibonnaci number&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># give the Deferred the answer to pass to the callbacks:</span>
    <span class="n">d</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>

    <span class="c1"># return the Deferred with the answer:</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="n">timeBefore</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># call the function and get our Deferred</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">largeFibonnaciNumber</span><span class="p">()</span>

<span class="n">timeAfter</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total time taken for largeFibonnaciNumber call: </span><span class="si">%0.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> \
      <span class="p">(</span><span class="n">timeAfter</span> <span class="o">-</span> <span class="n">timeBefore</span><span class="p">))</span>

<span class="c1"># add a callback to it to print the number</span>

<span class="k">def</span> <span class="nf">printNumber</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The </span><span class="si">%d</span><span class="s2">th Fibonacci number is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="n">number</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding the callback now.&quot;</span><span class="p">)</span>

<span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">printNumber</span><span class="p">)</span>
</pre></div>
</div>
<p>You will notice that despite creating a Deferred in the  <code class="docutils literal notranslate"><span class="pre">largeFibonnaciNumber</span></code> function, these things happened:</p>
<ul class="simple">
<li><p>the “Total time taken for largeFibonnaciNumber call” output
shows that the function did not return immediately as asynchronous functions
are expected to do; and</p></li>
<li><p>rather than the callback being added before the result was available and
called after the result is available, it isn’t even added until after the
calculation has been completed.</p></li>
</ul>
<p>The function completed its calculation before returning, blocking the
process until it had finished, which is exactly what asynchronous functions
are not meant to do.  Deferreds are not a non-blocking talisman: they are a
signal for asynchronous functions to <em>use</em> to pass results onto
callbacks, but using them does not guarantee that you have an asynchronous
function.</p>
</section>
<section id="advanced-processing-chain-control">
<h2>Advanced Processing Chain Control<a class="headerlink" href="#advanced-processing-chain-control" title="Permalink to this heading"></a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pause()</span></code></p>
<p>Cease calling any methods as they are added, and do not
respond to <code class="docutils literal notranslate"><span class="pre">callback</span></code> , until
<code class="docutils literal notranslate"><span class="pre">self.unpause()</span></code> is called.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unpause()</span></code></p>
<p>If <code class="docutils literal notranslate"><span class="pre">callback</span></code> has been called on this
Deferred already, call all the callbacks that have been
added to this Deferred since <code class="docutils literal notranslate"><span class="pre">pause</span></code> was
called.</p>
<p>Whether it was called or not, this will put this
Deferred in a state where further calls to
<code class="docutils literal notranslate"><span class="pre">addCallbacks</span></code> or <code class="docutils literal notranslate"><span class="pre">callback</span></code> will
work as normal.</p>
</li>
</ul>
</section>
<section id="returning-deferreds-from-synchronous-functions">
<h2>Returning Deferreds from synchronous functions<a class="headerlink" href="#returning-deferreds-from-synchronous-functions" title="Permalink to this heading"></a></h2>
<p>Sometimes you might wish to return a Deferred from a synchronous function.
There are several reasons why, the major two are maintaining API compatibility
with another version of your function which returns a Deferred, or allowing
for the possibility that in the future your function might need to be
asynchronous.</p>
<p>In the <a class="reference internal" href="defer.html"><span class="doc">Using Deferreds</span></a> reference, we gave the
following example of a synchronous function:</p>
<p><a class="reference download internal" download="" href="../../_downloads/2b5164868557eb1d26ade76337b97da5/synch-validation.py"><code class="xref download docutils literal notranslate"><span class="pre">synch-validation.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">synchronousIsValidUser</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return true if user is a valid user, false otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">user</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Angus&quot;</span><span class="p">,</span> <span class="s2">&quot;Agnes&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>While we can require that callers of our function wrap our synchronous
result in a Deferred using <code class="xref py py-func docutils literal notranslate"><span class="pre">maybeDeferred</span></code> , for the sake of API
compatibility it is better to return a Deferred ourselves using  <code class="xref py py-func docutils literal notranslate"><span class="pre">defer.succeed</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>

<span class="k">def</span> <span class="nf">immediateIsValidUser</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a Deferred resulting in true if user is a valid user, false</span>
<span class="sd">    otherwise</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">user</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Angus&quot;</span><span class="p">,</span> <span class="s2">&quot;Agnes&quot;</span><span class="p">]</span>

    <span class="c1"># return a Deferred object already called back with the value of result</span>
    <span class="k">return</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>There is an equivalent <code class="xref py py-func docutils literal notranslate"><span class="pre">defer.fail</span></code> method to return a Deferred with the
errback chain already fired.</p>
</section>
<section id="integrating-blocking-code-with-twisted">
<h2>Integrating blocking code with Twisted<a class="headerlink" href="#integrating-blocking-code-with-twisted" title="Permalink to this heading"></a></h2>
<p>At some point, you are likely to need to call a blocking function: many
functions in third party libraries will have long running blocking functions.
There is no way to ‘force’ a function to be asynchronous: it must be written
that way specifically. When using Twisted, your own code should be
asynchronous, but there is no way to make third party functions asynchronous
other than rewriting them.</p>
<p>In this case, Twisted provides the ability to run the blocking code in a
separate thread rather than letting it block your application. The <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.internet.threads.deferToThread()</span></code> function will set up
a thread to run your blocking function, return a Deferred and later fire that
Deferred when the thread completes.</p>
<p>Let’s assume our <code class="docutils literal notranslate"><span class="pre">largeFibonnaciNumber</span></code> function
from above is in a third party library (returning the result of the
calculation, not a Deferred) and is not easily modifiable to be finished in
discrete blocks. This example shows it being called in a thread, unlike in the
earlier section we’ll see that the operation does not block our entire
program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">largeFibonnaciNumber</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a long running blocking function by calculating</span>
<span class="sd">    the TARGETth Fibonnaci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TARGET</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">second</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TARGET</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">second</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">new</span>

    <span class="k">return</span> <span class="n">second</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">threads</span><span class="p">,</span> <span class="n">reactor</span>

<span class="k">def</span> <span class="nf">fibonacciCallback</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback which manages the largeFibonnaciNumber result by</span>
<span class="sd">    printing it out</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;largeFibonnaciNumber result =&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="c1"># make sure the reactor stops after the callback chain finishes,</span>
    <span class="c1"># just so that this example terminates</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a series of operations, deferring the largeFibonnaciNumber</span>
<span class="sd">    operation to a thread and performing some other operations after</span>
<span class="sd">    adding the callback</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get our Deferred which will be called with the largeFibonnaciNumber result</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">threads</span><span class="o">.</span><span class="n">deferToThread</span><span class="p">(</span><span class="n">largeFibonnaciNumber</span><span class="p">)</span>
    <span class="c1"># add our callback to print it out</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">fibonacciCallback</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1st line after the addition of the callback&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2nd line after the addition of the callback&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="possible-sources-of-error">
<h2>Possible sources of error<a class="headerlink" href="#possible-sources-of-error" title="Permalink to this heading"></a></h2>
<p>Deferreds greatly simplify the process of writing asynchronous code by
providing a standard for registering callbacks, but there are some subtle and
sometimes confusing rules that you need to follow if you are going to use
them. This mostly applies to people who are writing new systems that use
Deferreds internally, and not writers of applications that just add callbacks
to Deferreds produced and processed by other systems. Nevertheless, it is good
to know.</p>
<section id="firing-deferreds-more-than-once-is-impossible">
<h3>Firing Deferreds more than once is impossible<a class="headerlink" href="#firing-deferreds-more-than-once-is-impossible" title="Permalink to this heading"></a></h3>
<p>Deferreds are one-shot. You can only call <code class="docutils literal notranslate"><span class="pre">Deferred.callback</span></code> or <code class="docutils literal notranslate"><span class="pre">Deferred.errback</span></code> once. The processing chain continues each time
you add new callbacks to an already-called-back-to Deferred.</p>
</section>
<section id="synchronous-callback-execution">
<h3>Synchronous callback execution<a class="headerlink" href="#synchronous-callback-execution" title="Permalink to this heading"></a></h3>
<p>If a Deferred already has a result available, <code class="docutils literal notranslate"><span class="pre">addCallback</span></code> <strong>may</strong> call the callback synchronously: that is, immediately
after it’s been added.  In situations where callbacks modify state, it is
might be desirable for the chain of processing to halt until all callbacks are
added. For this, it is possible to <code class="docutils literal notranslate"><span class="pre">pause</span></code> and <code class="docutils literal notranslate"><span class="pre">unpause</span></code>
a Deferred’s processing chain while you are adding lots of callbacks.</p>
<p>Be careful when you use these methods! If you <code class="docutils literal notranslate"><span class="pre">pause</span></code> a
Deferred, it is <em>your</em> responsibility to make sure that you unpause it.
The function adding the callbacks must unpause a paused Deferred, it should <em>never</em> be the responsibility of the code that actually fires the
callback chain by calling <code class="docutils literal notranslate"><span class="pre">callback</span></code> or <code class="docutils literal notranslate"><span class="pre">errback</span></code> as
this would negate its usefulness!</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="defer.html" class="btn btn-neutral float-left" title="Deferred Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="time.html" class="btn btn-neutral float-right" title="Scheduling tasks for the future" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-09.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>