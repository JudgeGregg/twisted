

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Communicating With IRC Clients &mdash; Twisted 22.4.0.post0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Examples" href="../examples/index.html" />
    <link rel="prev" title="Using the Twisted IRC Client" href="ircclient.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Twisted
          

          
          </a>

          
            
            
              <div class="version">
                22.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Words (IRC and XMPP)</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="im.html">Overview of Twisted IM</a></li>
<li class="toctree-l3"><a class="reference internal" href="ircclient.html">Using the Twisted IRC Client</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Communicating With IRC Clients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#representing-clients-in-twisted">Representing Clients in Twisted</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sending-messages">Sending Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Twisted Words (IRC and XMPP)</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
        
      <li>Communicating With IRC Clients</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/words/howto/ircserverclientcomm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="communicating-with-irc-clients">
<h1>Communicating With IRC Clients<a class="headerlink" href="#communicating-with-irc-clients" title="Permalink to this heading">¶</a></h1>
<p>Communicating with clients is the whole point of an IRC server, so you want to make sure you’re doing it properly.
Today, we’ll be looking at receiving messages from a client and sending messages to the client.</p>
<div class="section" id="representing-clients-in-twisted">
<h2>Representing Clients in Twisted<a class="headerlink" href="#representing-clients-in-twisted" title="Permalink to this heading">¶</a></h2>
<p>Users in Twisted IRC are represented as subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">the</span> <span class="pre">IRC</span> <span class="pre">class</span></code>.
This works as the protocol for your Factory class. It will also give you IRC features (like automatically parsing incoming lines) without you having to implement them yourself. The rest of this guide assumes this setup.</p>
</div>
<div class="section" id="sending-messages">
<h2>Sending Messages<a class="headerlink" href="#sending-messages" title="Permalink to this heading">¶</a></h2>
<p>Messages are sent to users using the user object’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">sendMessage</span></code> method.</p>
<div class="section" id="sending-basic-messages">
<h3>Sending Basic Messages<a class="headerlink" href="#sending-basic-messages" title="Permalink to this heading">¶</a></h3>
<p>The basic syntax for sending messages to users is
as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;COMMAND&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">),</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The prefix keyword argument is optional, and it may be omitted to send a message without a prefix (for example, the ERROR command).
The command is whatever command you plan to send, e.g. “PRIVMSG”, “MODE”, etc.
All arguments following the command are the parameters you want to send for the command.
If the last argument needs to be prefixed with a colon (because it has spaces in it, e.g. a PRIVMSG message), you must add the colon to the beginning of the parameter yourself. For example:
.. code-block:: python</p>
<blockquote>
<div><p>user.sendCommand(“PRIVMSG”, (user.nickname, “:{}”.format(message)), sendingUser.hostmask)</p>
</div></blockquote>
</div>
<div class="section" id="sending-messages-with-tags">
<h3>Sending Messages with Tags<a class="headerlink" href="#sending-messages-with-tags" title="Permalink to this heading">¶</a></h3>
<p>Twisted also allows sending message tags as specified in
<a class="reference external" href="https://ircv3.net/specs/core/message-tags-3.2.html">IRCv3</a>.</p>
<p>Let’s say, for example, that your server has a feature to play back a little bit of previous channel content when someone joins a channel.
You want a way to tell people when this message occurred.  The best way to provide this information is through the <a class="reference external" href="http://ircv3.net/specs/extensions/server-time-3.2.html">server-time specification</a>.</p>
<p>Let’s say you’re storing past messages in a channel object in some structure like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">channel</span><span class="o">.</span><span class="n">pastMessages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;I sent some text!&quot;</span><span class="p">,</span> <span class="s2">&quot;author!ident@host&quot;</span><span class="p">,</span> <span class="n">datetime</span> <span class="nb">object</span> <span class="n">representing</span> <span class="n">the</span> <span class="n">when</span> <span class="n">the</span> <span class="n">message</span> <span class="n">was</span> <span class="n">sent</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;I did, too!&quot;</span><span class="p">,</span> <span class="s2">&quot;someone-else!ident@host&quot;</span><span class="p">,</span> <span class="n">another</span> <span class="n">datetime</span> <span class="nb">object</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Your actual implementation may vary. I went with something simple here. The times of the messages would be generated using something like <code class="docutils literal notranslate"><span class="pre">datetime.utcnow()</span></code> when the message was received.</p>
<p>Tags are passed as a list of tuples. If you’re sending a number of tags, you may have an existing tag dictionary. You can simply add to it (assuming <code class="docutils literal notranslate"><span class="pre">message</span></code> is the loop variable for channel.pastMessages above):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sendingTags</span><span class="p">[</span><span class="s2">&quot;server-time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Z&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>This will generate the required time format and add it to the tag dictionary. The last three characters that we remove are the microseconds; removing the last three digits changes the precision to milliseconds.</p>
<p>Once your tags are collected, you can send the message. The tag dictionary is passed using the <code class="docutils literal notranslate"><span class="pre">tags</span></code> argument (in the same loop as above):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;PRIVMSG&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">nickname</span><span class="p">,</span> <span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">message</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sendingTags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="receiving-messages">
<h2>Receiving Messages<a class="headerlink" href="#receiving-messages" title="Permalink to this heading">¶</a></h2>
<p>Twisted Words will handle receiving messages and parsing lines into tokens. The parsed messages are passed into your command through the user’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">handleCommand</span></code> method.</p>
<div class="section" id="handling-commands">
<h3>Handling Commands<a class="headerlink" href="#handling-commands" title="Permalink to this heading">¶</a></h3>
<p>The default IRC handleCommand method calls the <code class="docutils literal notranslate"><span class="pre">irc_COMMAND</span></code> method when it receives the command <code class="docutils literal notranslate"><span class="pre">COMMAND</span></code>, and it calls irc_unknown if the method for the command received isn’t defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.words.protocols</span> <span class="kn">import</span> <span class="n">irc</span>

<span class="k">class</span> <span class="nc">IRCUser</span><span class="p">(</span><span class="n">irc</span><span class="o">.</span><span class="n">IRC</span><span class="p">):</span>
    <span class="c1"># possibly other definitions here</span>
    <span class="k">def</span> <span class="nf">irc_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="n">irc</span><span class="o">.</span><span class="n">ERR_UNKNOWNCOMMAND</span><span class="p">,</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="s2">&quot;:Unknown command&quot;</span><span class="p">),</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">irc_PRIVMSG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># do some stuff to handle PRIVMSG for your server&#39;s setup</span>

    <span class="c1"># lots of other command definitions</span>
</pre></div>
</div>
<p>If you have a server setup that doesn’t allow you to do this (e.g. a modular server program), you may, of course, override the handleCommand function to route commands to your own handlers.</p>
</div>
<div class="section" id="receiving-messages-with-tags">
<h3>Receiving Messages with Tags<a class="headerlink" href="#receiving-messages-with-tags" title="Permalink to this heading">¶</a></h3>
<p>This has not yet been implemented.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../examples/index.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="ircclient.html" class="btn btn-neutral float-left" title="Using the Twisted IRC Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Twisted Matrix Labs. Ver 22.4.0.post0. Built on 2022-09-04.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>