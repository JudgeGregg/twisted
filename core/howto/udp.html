<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UDP Networking &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using Processes" href="process.html" />
    <link rel="prev" title="Using TLS in Twisted" href="ssl.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vision.html">The Vision For Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="servers.html">Writing Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="clients.html">Writing Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="trial.html">Test-driven development with Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/index.html">Twisted from Scratch, or The Evolution of Finger</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/intro.html">The Evolution of Finger: building a simple finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/protocol.html">The Evolution of Finger: adding features to the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/style.html">The Evolution of Finger: cleaning up the finger code</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/components.html">The Evolution of Finger: moving to a component based architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/backends.html">The Evolution of Finger: pluggable backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/web.html">The Evolution of Finger: a web frontend</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/pb.html">The Evolution of Finger: Twisted client support using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/factory.html">The Evolution of Finger: using a single factory for multiple protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/client.html">The Evolution of Finger: a Twisted finger client</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/library.html">The Evolution of Finger: making a finger library</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/configuration.html">The Evolution of Finger: configuration of the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="quotes.html">Setting up the TwistedQuotes application</a></li>
<li class="toctree-l3"><a class="reference internal" href="design.html">Designing Twisted Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="internet-overview.html">Overview of Twisted Internet</a></li>
<li class="toctree-l3"><a class="reference internal" href="reactor-basics.html">Reactor Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl.html">Using TLS in Twisted</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">UDP Networking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datagramprotocol">DatagramProtocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adopting-datagram-ports">Adopting Datagram Ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connected-udp">Connected UDP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multicast-udp">Multicast UDP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-udp">Broadcast UDP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6">IPv6</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="process.html">Using Processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer-intro.html">Introduction to Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer.html">Deferred Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="gendefer.html">Generating Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="time.html">Scheduling tasks for the future</a></li>
<li class="toctree-l3"><a class="reference internal" href="threading.html">Using Threads in Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="producers.html">Producers and Consumers: Efficient High-Volume Streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="choosing-reactor.html">Choosing a Reactor and GUI Toolkit Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="endpoints.html">Getting Connected with Endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="components.html">Components: Interfaces and Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cred.html">Cred: Pluggable Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin.html">The Twisted Plugin System</a></li>
<li class="toctree-l3"><a class="reference internal" href="basics.html">The Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="application.html">Using the Twisted Application Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="tap.html">Writing a twistd Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="systemd.html">Deploying Twisted with systemd</a></li>
<li class="toctree-l3"><a class="reference internal" href="logger.html">Logging with twisted.logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">Twisted’s Legacy Logging System: <code class="docutils literal notranslate"><span class="pre">twisted.python.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="constants.html">Symbolic Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="rdbms.html">twisted.enterprise.adbapi: Twisted RDBMS support</a></li>
<li class="toctree-l3"><a class="reference internal" href="options.html">Parsing command-lines with usage.Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="dirdbm.html">DirDBM: Directory-based Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Writing tests for Twisted code using Trial</a></li>
<li class="toctree-l3"><a class="reference internal" href="sendmsg.html">Extremely Low-Level Socket Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="amp.html">Asynchronous Messaging Protocol Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb.html">Overview of Twisted Spread</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-intro.html">Introduction to Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-usage.html">Using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-clients.html">Managing Clients of Perspectives</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-copyable.html">PB Copyable: Passing Complex Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-cred.html">Authentication with Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-limits.html">PB Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html">Porting to Python 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="positioning.html">Twisted Positioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Twisted Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="debug-with-emacs.html">Debugging Python(Twisted) with Emacs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specifications/index.html">Specifications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Core</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>UDP Networking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/core/howto/udp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="udp-networking">
<h1>UDP Networking<a class="headerlink" href="#udp-networking" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Unlike TCP, UDP has no notion of connections.
A UDP socket can receive datagrams from any server on the network and send datagrams to any host on the network.
In addition, datagrams may arrive in any order, never arrive at all, or be duplicated in transit.</p>
<p>Since there are no connections, we only use a single object, a protocol, for each UDP socket.
We then use the reactor to connect this protocol to a UDP transport, using the <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.interfaces.IReactorUDP</span></code> reactor API.</p>
</section>
<section id="datagramprotocol">
<h2>DatagramProtocol<a class="headerlink" href="#datagramprotocol" title="Permalink to this headline"></a></h2>
<p>The class where you actually implement the protocol parsing and handling will usually be descended from <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.protocol.DatagramProtocol</span></code> or from one of its convenience children.
The <code class="docutils literal notranslate"><span class="pre">DatagramProtocol</span></code> class receives datagrams and can send them out over the network.
Received datagrams include the address they were sent from.
When sending datagrams the destination address must be specified.</p>
<p>Here is a simple example:</p>
<p><a class="reference download internal" download="" href="../../_downloads/73071c19dd738788bccc7b8932100d66/basic_example.py"><code class="xref download docutils literal notranslate"><span class="pre">basic_example.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.protocol</span> <span class="kn">import</span> <span class="n">DatagramProtocol</span>


<span class="k">class</span> <span class="nc">Echo</span><span class="p">(</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">datagramReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s2"> from </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">listenUDP</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="n">Echo</span><span class="p">())</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>As you can see, the protocol is registered with the reactor.
This means it may be persisted if it’s added to an application, and thus it has <code class="xref py py-meth docutils literal notranslate"><span class="pre">startProtocol</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">stopProtocol</span></code> methods that will get called when the protocol is connected and disconnected from a UDP socket.</p>
<p>The protocol’s <code class="docutils literal notranslate"><span class="pre">transport</span></code> attribute will implement the <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.interfaces.IUDPTransport</span></code> interface.
Notice that <code class="docutils literal notranslate"><span class="pre">addr</span></code> argument to <code class="docutils literal notranslate"><span class="pre">self.transport.write</span></code> should be a tuple with IP address and port number. First element of tuple must be ip address and not a hostname. If you only have the hostname use <code class="docutils literal notranslate"><span class="pre">reactor.resolve()</span></code> to resolve the address (see <code class="xref py py-meth docutils literal notranslate"><span class="pre">twisted.internet.interfaces.IReactorCore.resolve()</span></code>).</p>
<p>Other thing to keep in mind is that data written to transport must be bytes. Trying to write string may work ok in Python 2, but will
fail if you are using Python 3.</p>
<p>To confirm that socket is indeed listening you can try following command line one-liner.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; <span class="nb">echo</span> <span class="s2">&quot;Hello World!&quot;</span> <span class="p">|</span> nc -4u -w1 localhost <span class="m">9999</span>
</pre></div>
</div>
<p>If everything is ok your “server” logs should print:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>received b<span class="s1">&#39;Hello World!\n&#39;</span> from <span class="o">(</span><span class="s1">&#39;127.0.0.1&#39;</span>, <span class="m">32844</span><span class="o">)</span> <span class="c1"># where 32844 is some random port number</span>
</pre></div>
</div>
</section>
<section id="adopting-datagram-ports">
<h2>Adopting Datagram Ports<a class="headerlink" href="#adopting-datagram-ports" title="Permalink to this headline"></a></h2>
<p>By default <code class="docutils literal notranslate"><span class="pre">reactor.listenUDP()</span></code> call will create appropriate socket for you, but it is also possible to add an existing
<code class="docutils literal notranslate"><span class="pre">SOCK_DGRAM</span></code> file descriptor of some socket to the reactor using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">adoptDatagramPort</span></code> API.</p>
<p>Here is a simple example:</p>
<p><a class="reference download internal" download="" href="../../_downloads/8db4ad47b5c09be31cd98b8109f49b3d/adopt_datagram_port.py"><code class="xref download docutils literal notranslate"><span class="pre">adopt_datagram_port.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.protocol</span> <span class="kn">import</span> <span class="n">DatagramProtocol</span>


<span class="k">class</span> <span class="nc">Echo</span><span class="p">(</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">datagramReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s2"> from </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>


<span class="c1"># Create new socket that will be passed to reactor later.</span>
<span class="n">portSocket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>

<span class="c1"># Make the port non-blocking and start it listening.</span>
<span class="n">portSocket</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">portSocket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>

<span class="c1"># Now pass the port file descriptor to the reactor.</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">reactor</span><span class="o">.</span><span class="n">adoptDatagramPort</span><span class="p">(</span><span class="n">portSocket</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">Echo</span><span class="p">())</span>

<span class="c1"># The portSocket should be cleaned up by the process that creates it.</span>
<span class="n">portSocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>You must ensure that the socket is non-blocking before passing its file descriptor to <code class="xref py py-meth docutils literal notranslate"><span class="pre">adoptDatagramPort</span></code>.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">adoptDatagramPort</span></code> cannot (<a class="reference external" href="https://twistedmatrix.com/trac/ticket/5599">currently</a>) detect the family of the adopted socket so you must ensure that you pass the correct socket family argument.</p></li>
<li><p>The reactor will not shutdown the socket.
It is the responsibility of the process that created the socket to shutdown and clean up the socket when it is no longer needed.</p></li>
</ul>
</div>
</section>
<section id="connected-udp">
<h2>Connected UDP<a class="headerlink" href="#connected-udp" title="Permalink to this headline"></a></h2>
<p>A connected UDP socket is slightly different from a standard one as it can only send and receive datagrams to/from a single address.
However this does not in any way imply a connection as datagrams may still arrive in any order and the port on the other side may have no one listening.
The benefit of the connected UDP socket is that it <strong>may</strong> provide notification of undelivered packages.
This depends on many factors (almost all of which are out of the control of the application) but still presents certain benefits which occasionally make it useful.</p>
<p>Unlike a regular UDP protocol, we do not need to specify where to send datagrams and are not told where they came from since they can only come from the address to which the socket is ‘connected’.</p>
<p><a class="reference download internal" download="" href="../../_downloads/52b40c13e1c9ab00a0d0183ac9d49157/connected_udp.py"><code class="xref download docutils literal notranslate"><span class="pre">connected_udp.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.protocol</span> <span class="kn">import</span> <span class="n">DatagramProtocol</span>


<span class="k">class</span> <span class="nc">Helloer</span><span class="p">(</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">startProtocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;192.168.1.1&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="mi">1234</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now we can only send to host </span><span class="si">%s</span><span class="s2"> port </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>  <span class="c1"># no need for address</span>

    <span class="k">def</span> <span class="nf">datagramReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s2"> from </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Possibly invoked if there is no server listening on the</span>
    <span class="c1"># address to which we are sending.</span>
    <span class="k">def</span> <span class="nf">connectionRefused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No one listening&quot;</span><span class="p">)</span>


<span class="c1"># 0 means any port, we don&#39;t care in this case</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">listenUDP</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Helloer</span><span class="p">())</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">connect()</span></code>, like <code class="docutils literal notranslate"><span class="pre">write()</span></code> will only accept IP addresses, not unresolved hostnames.
To obtain the IP of a hostname use <code class="docutils literal notranslate"><span class="pre">reactor.resolve()</span></code>, e.g:</p>
<p><a class="reference download internal" download="" href="../../_downloads/7758818d069c3840c6a8277b6fdd7c0c/getting_ip.py"><code class="xref download docutils literal notranslate"><span class="pre">getting_ip.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>


<span class="k">def</span> <span class="nf">gotIP</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IP of &#39;localhost&#39; is&quot;</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">gotIP</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Connecting to a new address after a previous connection or making a connected port unconnected are not currently supported, but likely will be in the future.</p>
</section>
<section id="multicast-udp">
<h2>Multicast UDP<a class="headerlink" href="#multicast-udp" title="Permalink to this headline"></a></h2>
<p>Multicast allows a process to contact multiple hosts with a single packet, without knowing the specific IP address of any of the hosts.
This is in contrast to normal, or unicast, UDP, where each datagram has a single IP as its destination.
Multicast datagrams are sent to special multicast group addresses (in the IPv4 range 224.0.0.0 to 239.255.255.255), along with a corresponding port.
In order to receive multicast datagrams, you must join that specific group address.
However, any UDP socket can send to multicast addresses. Here is a simple server example:</p>
<p><a class="reference download internal" download="" href="../../_downloads/2c359f46bc810a86d66817a035c12f96/MulticastServer.py"><code class="xref download docutils literal notranslate"><span class="pre">MulticastServer.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.protocol</span> <span class="kn">import</span> <span class="n">DatagramProtocol</span>


<span class="k">class</span> <span class="nc">MulticastPingPong</span><span class="p">(</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">startProtocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after protocol has started listening.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set the TTL&gt;1 so multicast will cross router hops:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">setTTL</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1"># Join a specific multicast group:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">joinGroup</span><span class="p">(</span><span class="s2">&quot;228.0.0.5&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">datagramReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datagram</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datagram </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">datagram</span><span class="p">)</span><span class="si">}</span><span class="s2"> received from </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datagram</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Client: Ping&quot;</span> <span class="ow">or</span> <span class="n">datagram</span> <span class="o">==</span> <span class="s2">&quot;Client: Ping&quot;</span><span class="p">:</span>
            <span class="c1"># Rather than replying to the group multicast address, we send the</span>
            <span class="c1"># reply directly (unicast) to the originating port:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Server: Pong&quot;</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>


<span class="c1"># We use listenMultiple=True so that we can run MulticastServer.py and</span>
<span class="c1"># MulticastClient.py on same machine:</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">listenMulticast</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="n">MulticastPingPong</span><span class="p">(),</span> <span class="n">listenMultiple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>As with UDP, with multicast there is no server/client differentiation at the protocol level.
Our server example is very simple and closely resembles a normal <code class="xref py py-meth docutils literal notranslate"><span class="pre">listenUDP</span></code> protocol implementation.
The main difference is that instead of <code class="docutils literal notranslate"><span class="pre">listenUDP</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">listenMulticast</span></code> is called with the port number.
The server calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">joinGroup</span></code> to join a multicast group.
A <code class="docutils literal notranslate"><span class="pre">DatagramProtocol</span></code> that is listening with multicast and has joined a group can receive multicast datagrams, but also unicast datagrams sent directly to its address.
The server in the example above sends such a unicast message in reply to the multicast message it receives from the client.</p>
<p>Client code may look like this:</p>
<p><a class="reference download internal" download="" href="../../_downloads/9a043cef1f09d173f0233ca47c050198/MulticastClient.py"><code class="xref download docutils literal notranslate"><span class="pre">MulticastClient.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.protocol</span> <span class="kn">import</span> <span class="n">DatagramProtocol</span>


<span class="k">class</span> <span class="nc">MulticastPingClient</span><span class="p">(</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">startProtocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Join the multicast address, so we can receive replies:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">joinGroup</span><span class="p">(</span><span class="s2">&quot;228.0.0.5&quot;</span><span class="p">)</span>
        <span class="c1"># Send to 228.0.0.5:9999 - all listeners on the multicast address</span>
        <span class="c1"># (including us) will receive this message.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Client: Ping&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;228.0.0.5&quot;</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">datagramReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datagram</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datagram </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">datagram</span><span class="p">)</span><span class="si">}</span><span class="s2"> received from </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">listenMulticast</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="n">MulticastPingClient</span><span class="p">(),</span> <span class="n">listenMultiple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that a multicast socket will have a default TTL (time to live) of 1.
That is, datagrams won’t traverse more than one router hop, unless a higher TTL is set with <code class="xref py py-meth docutils literal notranslate"><span class="pre">setTTL</span></code>.
Other functionality provided by the multicast transport includes <code class="xref py py-meth docutils literal notranslate"><span class="pre">setOutgoingInterface</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">setLoopbackMode</span></code> – see <code class="xref py py-class docutils literal notranslate"><span class="pre">IMulticastTransport</span></code> for more information.</p>
<p>To test your multicast setup you need to start server in one terminal and couple of clients in other terminals. If all
goes ok you should see “Ping” messages sent by each client in logs of all other connected clients.</p>
</section>
<section id="broadcast-udp">
<h2>Broadcast UDP<a class="headerlink" href="#broadcast-udp" title="Permalink to this headline"></a></h2>
<p>Broadcast allows a different way of contacting several unknown hosts.
Broadcasting via UDP sends a packet out to all hosts on the local network by sending to a magic broadcast address (<code class="docutils literal notranslate"><span class="pre">&quot;&lt;broadcast&gt;&quot;</span></code>).
This broadcast is filtered by routers by default, and there are no “groups” like multicast, only different ports.</p>
<p>Broadcast is enabled by passing <code class="docutils literal notranslate"><span class="pre">True</span></code> to <code class="xref py py-meth docutils literal notranslate"><span class="pre">setBroadcastAllowed</span></code> on the port.
Checking the broadcast status can be done with <code class="xref py py-meth docutils literal notranslate"><span class="pre">getBroadcastAllowed</span></code> on the port.</p>
<p>For a complete example of this feature, see <a class="reference download internal" download="" href="../../_downloads/e4241d6d152e5d4ad16beb3b5b672e86/udpbroadcast.py"><code class="xref download docutils literal notranslate"><span class="pre">udpbroadcast.py</span></code></a>.</p>
</section>
<section id="ipv6">
<h2>IPv6<a class="headerlink" href="#ipv6" title="Permalink to this headline"></a></h2>
<p>UDP sockets can also bind to IPv6 addresses to support sending and receiving datagrams over IPv6.
By passing an IPv6 address to <code class="xref py py-meth docutils literal notranslate"><span class="pre">listenUDP</span></code>’s <code class="docutils literal notranslate"><span class="pre">interface</span></code> argument, the reactor will start an IPv6 socket that can be used to send and receive UDP datagrams.</p>
<p><a class="reference download internal" download="" href="../../_downloads/c416851bac40392bc261cda29434348f/ipv6_listen.py"><code class="xref download docutils literal notranslate"><span class="pre">ipv6_listen.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.protocol</span> <span class="kn">import</span> <span class="n">DatagramProtocol</span>


<span class="k">class</span> <span class="nc">Echo</span><span class="p">(</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">datagramReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s2"> from </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">listenUDP</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="n">Echo</span><span class="p">(),</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&quot;::&quot;</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ssl.html" class="btn btn-neutral float-left" title="Using TLS in Twisted" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="process.html" class="btn btn-neutral float-right" title="Using Processes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>