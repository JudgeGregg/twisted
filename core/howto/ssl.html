<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using TLS in Twisted &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="UDP Networking" href="udp.html" />
    <link rel="prev" title="Reactor Overview" href="reactor-basics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vision.html">The Vision For Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="servers.html">Writing Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="clients.html">Writing Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="trial.html">Test-driven development with Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/index.html">Twisted from Scratch, or The Evolution of Finger</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/intro.html">The Evolution of Finger: building a simple finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/protocol.html">The Evolution of Finger: adding features to the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/style.html">The Evolution of Finger: cleaning up the finger code</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/components.html">The Evolution of Finger: moving to a component based architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/backends.html">The Evolution of Finger: pluggable backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/web.html">The Evolution of Finger: a web frontend</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/pb.html">The Evolution of Finger: Twisted client support using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/factory.html">The Evolution of Finger: using a single factory for multiple protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/client.html">The Evolution of Finger: a Twisted finger client</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/library.html">The Evolution of Finger: making a finger library</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/configuration.html">The Evolution of Finger: configuration of the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="quotes.html">Setting up the TwistedQuotes application</a></li>
<li class="toctree-l3"><a class="reference internal" href="design.html">Designing Twisted Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="internet-overview.html">Overview of Twisted Internet</a></li>
<li class="toctree-l3"><a class="reference internal" href="reactor-basics.html">Reactor Overview</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using TLS in Twisted</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tls-echo-server-and-client">TLS echo server and client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-starttls">Using startTLS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#client-authentication">Client authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-layer-protocol-negotiation-alpn-and-next-protocol-negotiation-npn">Application Layer Protocol Negotiation (ALPN) and Next Protocol Negotiation (NPN)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#related-facilities">Related facilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="udp.html">UDP Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="process.html">Using Processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer-intro.html">Introduction to Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer.html">Deferred Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="gendefer.html">Generating Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="time.html">Scheduling tasks for the future</a></li>
<li class="toctree-l3"><a class="reference internal" href="threading.html">Using Threads in Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="producers.html">Producers and Consumers: Efficient High-Volume Streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="choosing-reactor.html">Choosing a Reactor and GUI Toolkit Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="endpoints.html">Getting Connected with Endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="components.html">Components: Interfaces and Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cred.html">Cred: Pluggable Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin.html">The Twisted Plugin System</a></li>
<li class="toctree-l3"><a class="reference internal" href="basics.html">The Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="application.html">Using the Twisted Application Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="tap.html">Writing a twistd Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="systemd.html">Deploying Twisted with systemd</a></li>
<li class="toctree-l3"><a class="reference internal" href="logger.html">Logging with twisted.logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">Twisted’s Legacy Logging System: <code class="docutils literal notranslate"><span class="pre">twisted.python.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="constants.html">Symbolic Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="rdbms.html">twisted.enterprise.adbapi: Twisted RDBMS support</a></li>
<li class="toctree-l3"><a class="reference internal" href="options.html">Parsing command-lines with usage.Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="dirdbm.html">DirDBM: Directory-based Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Writing tests for Twisted code using Trial</a></li>
<li class="toctree-l3"><a class="reference internal" href="sendmsg.html">Extremely Low-Level Socket Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="amp.html">Asynchronous Messaging Protocol Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb.html">Overview of Twisted Spread</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-intro.html">Introduction to Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-usage.html">Using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-clients.html">Managing Clients of Perspectives</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-copyable.html">PB Copyable: Passing Complex Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-cred.html">Authentication with Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-limits.html">PB Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html">Porting to Python 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="positioning.html">Twisted Positioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Twisted Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="debug-with-emacs.html">Debugging Python(Twisted) with Emacs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specifications/index.html">Specifications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Core</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>Using TLS in Twisted</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/core/howto/ssl.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-tls-in-twisted">
<h1>Using TLS in Twisted<a class="headerlink" href="#using-tls-in-twisted" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This document describes how to secure your communications using TLS (Transport Layer Security) — also known as SSL (Secure Sockets Layer) — in Twisted servers and clients.
It assumes that you know what TLS is, what some of the major reasons to use it are, and how to generate your own certificates.
It also assumes that you are comfortable with creating TCP servers and clients as described in the <a class="reference internal" href="servers.html"><span class="doc">server howto</span></a> and <a class="reference internal" href="clients.html"><span class="doc">client howto</span></a> .
After reading this document you should be able to create servers and clients that can use TLS to encrypt their connections, switch from using an unencrypted channel to an encrypted one mid-connection, and require client authentication.</p>
<p>Using TLS in Twisted requires that you have <a class="reference external" href="https://github.com/pyca/pyopenssl">pyOpenSSL</a> installed. A quick test to verify that you do is to run <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">OpenSSL</span> <span class="pre">import</span> <span class="pre">SSL</span></code> at a python prompt and not get an error.</p>
<p>Twisted provides TLS support as a transport — that is, as an alternative to TCP.
When using TLS, use of the TCP APIs you’re already familiar with, <code class="docutils literal notranslate"><span class="pre">TCP4ClientEndpoint</span></code> and <code class="docutils literal notranslate"><span class="pre">TCP4ServerEndpoint</span></code> — or <code class="docutils literal notranslate"><span class="pre">reactor.listenTCP</span></code> and <code class="docutils literal notranslate"><span class="pre">reactor.connectTCP</span></code> — is replaced by use of parallel TLS APIs (many of which still use the legacy name “SSL” due to age and/or compatibility with older APIs).
To create a TLS server, use <code class="xref py py-class docutils literal notranslate"><span class="pre">SSL4ServerEndpoint</span></code> or <code class="xref py py-meth docutils literal notranslate"><span class="pre">listenSSL</span></code> .
To create a TLS client, use <code class="xref py py-class docutils literal notranslate"><span class="pre">SSL4ClientEndpoint</span></code> or <code class="xref py py-meth docutils literal notranslate"><span class="pre">connectSSL</span></code> .</p>
<p>TLS provides transport layer security, but it’s important to understand what “security” means.
With respect to TLS it means three things:</p>
<ol class="arabic simple">
<li><p>Identity: TLS servers (and sometimes clients) present a certificate, offering proof of who they are, so that you know who you are talking to.</p></li>
<li><p>Confidentiality: once you know who you are talking to, encryption of the connection ensures that the communications can’t be understood by any third parties who might be listening in.</p></li>
<li><p>Integrity: TLS checks the encrypted messages to ensure that they actually came from the party you originally authenticated to.
If the messages fail these checks, then they are discarded and your application does not see them.</p></li>
</ol>
<p>Without identity, neither confidentiality nor integrity is possible.
If you don’t know who you’re talking to, then you might as easily be talking to your bank or to a thief who wants to steal your bank password.
Each of the APIs listed above with “SSL” in the name requires a configuration object called (for historical reasons) a <code class="docutils literal notranslate"><span class="pre">contextFactory</span></code>.
(Please pardon the somewhat awkward name.)
The <code class="docutils literal notranslate"><span class="pre">contextFactory</span></code> serves three purposes:</p>
<ol class="arabic simple">
<li><p>It provides the materials to prove your own identity to the other side of the connection: in other words, who you are.</p></li>
<li><p>It expresses your requirements of the other side’s identity: in other words, who you would like to talk to (and who you trust to tell you that you’re talking to the right party).</p></li>
<li><p>It allows you to specify certain specialized options about the way the TLS protocol itself operates.</p></li>
</ol>
<p>The requirements of clients and servers are slightly different.
Both <em>can</em> provide a certificate to prove their identity, but commonly, TLS <em>servers</em> provide a certificate, whereas TLS <em>clients</em> check the server’s certificate (to make sure they’re talking to the right server) and then later identify themselves to the server some other way, often by offering a shared secret such as a password or API key via an application protocol secured with TLS and not as part of TLS itself.</p>
<p>Since these requirements are slightly different, there are different APIs to construct an appropriate <code class="docutils literal notranslate"><span class="pre">contextFactory</span></code> value for a client or a server.</p>
<p>For servers, we can use <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.ssl.CertificateOptions</span></code>.
In order to prove the server’s identity, you pass the <code class="docutils literal notranslate"><span class="pre">privateKey</span></code> and <code class="docutils literal notranslate"><span class="pre">certificate</span></code> arguments to this object.
<code class="xref py py-meth docutils literal notranslate"><span class="pre">twisted.internet.ssl.PrivateCertificate.options()</span></code> is a convenient way to create a <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> instance configured to use a particular key and certificate.</p>
<p>For clients, we can use <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.internet.ssl.optionsForClientTLS()</span></code>.
This takes two arguments, <code class="docutils literal notranslate"><span class="pre">hostname</span></code> (which indicates what hostname must be advertised in the server’s certificate) and optionally <code class="docutils literal notranslate"><span class="pre">trustRoot</span></code>.
By default, <code class="xref py py-func docutils literal notranslate"><span class="pre">optionsForClientTLS</span></code> tries to obtain the trust roots from your platform, but you can specify your own.</p>
<p>You may obtain an object suitable to pass as the <code class="docutils literal notranslate"><span class="pre">trustRoot=</span></code> parameter with an explicit list of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.ssl.Certificate</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.ssl.PrivateCertificate</span></code> instances by calling <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.internet.ssl.trustRootFromCertificates()</span></code>. This will cause <code class="xref py py-func docutils literal notranslate"><span class="pre">optionsForClientTLS</span></code> to accept any connection so long as the server’s certificate is signed by at least one of the certificates passed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, Twisted only supports loading of OpenSSL’s default trust roots.
If you’ve built OpenSSL yourself, you must take care to include these in the appropriate location.
If you’re using the OpenSSL shipped as part of macOS 10.5-10.9, this behavior will also be correct.
If you’re using Debian, or one of its derivatives like Ubuntu, install the <cite>ca-certificates</cite> package to ensure you have trust roots available, and this behavior should also be correct.
Work is ongoing to make <code class="xref py py-func docutils literal notranslate"><span class="pre">platformTrust</span></code> — the API that <code class="xref py py-func docutils literal notranslate"><span class="pre">optionsForClientTLS</span></code> uses by default — more robust.
For example, <code class="xref py py-func docutils literal notranslate"><span class="pre">platformTrust</span></code> should fall back to <a class="reference external" href="https://pypi.org/project/certifi">the “certifi” package</a> if no platform trust roots are available but it doesn’t do that yet.
When this happens, you shouldn’t need to change your code.</p>
</div>
</section>
<section id="tls-echo-server-and-client">
<h2>TLS echo server and client<a class="headerlink" href="#tls-echo-server-and-client" title="Permalink to this headline"></a></h2>
<p>Now that we’ve got the theory out of the way, let’s try some working examples of how to get started with a TLS server.
The following examples rely on the files <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> (private key and self-signed certificate together) and <code class="docutils literal notranslate"><span class="pre">public.pem</span></code> (the server’s public certificate by itself).</p>
<section id="tls-echo-server">
<h3>TLS echo server<a class="headerlink" href="#tls-echo-server" title="Permalink to this headline"></a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/e1916f5fd0bcb36d768c3457a7a49755/echoserv_ssl.py"><code class="xref download docutils literal notranslate"><span class="pre">echoserv_ssl.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># Copyright (c) Twisted Matrix Laboratories.</span>
<span class="c1"># See LICENSE for details.</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">echoserv</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.python</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">twisted.python.modules</span> <span class="kn">import</span> <span class="n">getModule</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">startLogging</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">certData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;server.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">certificate</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PrivateCertificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">certData</span><span class="p">)</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Factory</span><span class="o">.</span><span class="n">forProtocol</span><span class="p">(</span><span class="n">echoserv</span><span class="o">.</span><span class="n">Echo</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">listenSSL</span><span class="p">(</span><span class="mi">8000</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">certificate</span><span class="o">.</span><span class="n">options</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">echoserv_ssl</span>

    <span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">echoserv_ssl</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>This server uses <code class="xref py py-meth docutils literal notranslate"><span class="pre">listenSSL</span></code> to listen for TLS traffic on port 8000, using the certificate and private key contained in the file <code class="docutils literal notranslate"><span class="pre">server.pem</span></code>.
It uses the same echo example server as the TCP echo server — even going so far as to import its protocol class.
Assuming that you can buy your own TLS certificate from a certificate authority, this is a fairly realistic TLS server.</p>
</section>
<section id="tls-echo-client">
<h3>TLS echo client<a class="headerlink" href="#tls-echo-client" title="Permalink to this headline"></a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/ce4fa9340e637062d2573d018baa7611/echoclient_ssl.py"><code class="xref download docutils literal notranslate"><span class="pre">echoclient_ssl.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># Copyright (c) Twisted Matrix Laboratories.</span>
<span class="c1"># See LICENSE for details.</span>

<span class="kn">import</span> <span class="nn">echoclient</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.python.modules</span> <span class="kn">import</span> <span class="n">getModule</span>


<span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Factory</span><span class="o">.</span><span class="n">forProtocol</span><span class="p">(</span><span class="n">echoclient</span><span class="o">.</span><span class="n">EchoClient</span><span class="p">)</span>
    <span class="n">certData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;public.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">authority</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">Certificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">certData</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">optionsForClientTLS</span><span class="p">(</span><span class="s2">&quot;example.com&quot;</span><span class="p">,</span> <span class="n">authority</span><span class="p">)</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">SSL4ClientEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">echoClient</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>

    <span class="n">done</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>
    <span class="n">echoClient</span><span class="o">.</span><span class="n">connectionLost</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">reason</span><span class="p">:</span> <span class="n">done</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">done</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">echoclient_ssl</span>

    <span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">echoclient_ssl</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>This client uses <code class="xref py py-class docutils literal notranslate"><span class="pre">SSL4ClientEndpoint</span></code> to connect to <code class="docutils literal notranslate"><span class="pre">echoserv_ssl.py</span></code>.
It <em>also</em> uses the same echo example client as the TCP echo client.
Whenever you have a protocol that listens on plain-text TCP it is easy to run it over TLS instead.
It specifies that it only wants to talk to a host named <code class="docutils literal notranslate"><span class="pre">&quot;example.com&quot;</span></code>, and that it trusts the certificate authority in <code class="docutils literal notranslate"><span class="pre">&quot;public.pem&quot;</span></code> to say who <code class="docutils literal notranslate"><span class="pre">&quot;example.com&quot;</span></code> is.
Note that the host you are connecting to — localhost — and the host whose identity you are verifying — example.com — can differ.
In this case, our example <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> certificate identifies a host named “example.com”, but your server is proably running on localhost.</p>
<p>In a realistic client, it’s very important that you pass the same “hostname”  your connection API (in this case, <code class="xref py py-class docutils literal notranslate"><span class="pre">SSL4ClientEndpoint</span></code>) and <code class="xref py py-func docutils literal notranslate"><span class="pre">optionsForClientTLS</span></code>.
In this case we’re using “<code class="docutils literal notranslate"><span class="pre">localhost</span></code>” as the host to connect to because you’re probably running this example on your own computer and “<code class="docutils literal notranslate"><span class="pre">example.com</span></code>” because that’s the value hard-coded in the dummy certificate distributed along with Twisted’s example code.</p>
</section>
<section id="connecting-to-public-servers">
<h3>Connecting To Public Servers<a class="headerlink" href="#connecting-to-public-servers" title="Permalink to this headline"></a></h3>
<p>Here is a short example, now using the default trust roots for <code class="xref py py-func docutils literal notranslate"><span class="pre">optionsForClientTLS</span></code> from <code class="xref py py-func docutils literal notranslate"><span class="pre">platformTrust</span></code>.</p>
<p><a class="reference download internal" download="" href="../../_downloads/52828aaefff0cb4caa3b70169a19bd9d/check_server_certificate.py"><code class="xref download docutils literal notranslate"><span class="pre">check_server_certificate.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">443</span><span class="p">):</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">optionsForClientTLS</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">host</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">ShowCertificate</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Protocol</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">connectionMade</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">dataReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">certificate</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">Certificate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">getPeerCertificate</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK:&quot;</span><span class="p">,</span> <span class="n">certificate</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">abortConnection</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">connectionLost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lost.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">ConnectionClosed</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BAD:&quot;</span><span class="p">,</span> <span class="n">reason</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">connectProtocol</span><span class="p">(</span>
        <span class="n">endpoints</span><span class="o">.</span><span class="n">SSL4ClientEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">options</span><span class="p">),</span> <span class="n">ShowCertificate</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">protocol</span><span class="o">.</span><span class="n">done</span><span class="p">)</span>


<span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
<p>You can use this tool fairly simply to retrieve certificates from an HTTPS server with a valid TLS certificate, by running it with a host name.
For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ python check_server_certificate.py www.twistedmatrix.com
OK: &lt;Certificate Subject=www.twistedmatrix.com ...&gt;
$ python check_server_certificate.py www.cacert.org
BAD: [(... &#39;certificate verify failed&#39;)]
$ python check_server_certificate.py dornkirk.twistedmatrix.com
BAD: No service reference ID could be validated against certificate.
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To <em>properly</em> validate your <code class="docutils literal notranslate"><span class="pre">hostname</span></code> parameter according to RFC6125, please also install the <a class="reference external" href="https://pypi.python.org/pypi/service_identity">“service_identity”</a> and <a class="reference external" href="https://pypi.python.org/pypi/idna">“idna”</a> packages from PyPI.
Without this package, Twisted will currently make a conservative guess as to the correctness of the server’s certificate, but this will reject a large number of potentially valid certificates.
<cite>service_identity</cite> implements the standard correctly and it will be a required dependency for TLS in a future release of Twisted.</p>
</div>
</section>
</section>
<section id="using-starttls">
<h2>Using startTLS<a class="headerlink" href="#using-starttls" title="Permalink to this headline"></a></h2>
<p>If you want to switch from unencrypted to encrypted traffic
mid-connection, you’ll need to turn on TLS with <code class="xref py py-meth docutils literal notranslate"><span class="pre">startTLS</span></code> on both
ends of the connection at the same time via some agreed-upon signal like the
reception of a particular message. You can readily verify the switch to an
encrypted channel by examining the packet payloads with a tool like
<a class="reference external" href="https://www.wireshark.org/">Wireshark</a> .</p>
<section id="starttls-server">
<h3>startTLS server<a class="headerlink" href="#starttls-server" title="Permalink to this headline"></a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/eb27d76ab7aae53844f9328e09ad3eb9/starttls_server.py"><code class="xref download docutils literal notranslate"><span class="pre">starttls_server.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.protocols.basic</span> <span class="kn">import</span> <span class="n">LineReceiver</span>
<span class="kn">from</span> <span class="nn">twisted.python.modules</span> <span class="kn">import</span> <span class="n">getModule</span>


<span class="k">class</span> <span class="nc">TLSServer</span><span class="p">(</span><span class="n">LineReceiver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">lineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;received: &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;STARTTLS&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- Switching to TLS&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendLine</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;READY&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startTLS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">certData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;server.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">cert</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PrivateCertificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">certData</span><span class="p">)</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Factory</span><span class="o">.</span><span class="n">forProtocol</span><span class="p">(</span><span class="n">TLSServer</span><span class="p">)</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">cert</span><span class="o">.</span><span class="n">options</span><span class="p">()</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
    <span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">starttls_server</span>

    <span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">starttls_server</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="starttls-client">
<h3>startTLS client<a class="headerlink" href="#starttls-client" title="Permalink to this headline"></a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/e18dc50618ced80dcc07e70de4cd7fe9/starttls_client.py"><code class="xref download docutils literal notranslate"><span class="pre">starttls_client.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.protocols.basic</span> <span class="kn">import</span> <span class="n">LineReceiver</span>
<span class="kn">from</span> <span class="nn">twisted.python.modules</span> <span class="kn">import</span> <span class="n">getModule</span>


<span class="k">class</span> <span class="nc">StartTLSClient</span><span class="p">(</span><span class="n">LineReceiver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">connectionMade</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendLine</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;plain text&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendLine</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;STARTTLS&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;received: &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;READY&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startTLS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendLine</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;secure text&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">loseConnection</span><span class="p">()</span>


<span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Factory</span><span class="o">.</span><span class="n">forProtocol</span><span class="p">(</span><span class="n">StartTLSClient</span><span class="p">)</span>
    <span class="n">certData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;server.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">optionsForClientTLS</span><span class="p">(</span>
        <span class="s2">&quot;example.com&quot;</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PrivateCertificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">certData</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">HostnameEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
    <span class="n">startTLSClient</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>

    <span class="n">done</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>
    <span class="n">startTLSClient</span><span class="o">.</span><span class="n">connectionLost</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">reason</span><span class="p">:</span> <span class="n">done</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">done</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">starttls_client</span>

    <span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">starttls_client</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">startTLS</span></code> is a transport method that gets passed a <code class="docutils literal notranslate"><span class="pre">contextFactory</span></code>.
It is invoked at an agreed-upon time in the data reception method of the client and server protocols.
The server uses <code class="docutils literal notranslate"><span class="pre">PrivateCertificate.options</span></code> to create a <code class="docutils literal notranslate"><span class="pre">contextFactory</span></code> which will use a particular certificate and private key (a common requirement for TLS servers).</p>
<p>The client creates an uncustomized <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> which is all that’s necessary for a TLS client to interact with a TLS server.</p>
</section>
</section>
<section id="client-authentication">
<h2>Client authentication<a class="headerlink" href="#client-authentication" title="Permalink to this headline"></a></h2>
<p>Server and client-side changes to require client authentication fall
largely under the dominion of pyOpenSSL, but few examples seem to exist on
the web so for completeness a sample server and client are provided here.</p>
<section id="tls-server-with-client-authentication-via-client-certificate-verification">
<h3>TLS server with client authentication via client certificate verification<a class="headerlink" href="#tls-server-with-client-authentication-via-client-certificate-verification" title="Permalink to this headline"></a></h3>
<p>When one or more certificates are passed to <code class="docutils literal notranslate"><span class="pre">PrivateCertificate.options</span></code>, the resulting <code class="docutils literal notranslate"><span class="pre">contextFactory</span></code> will use those certificates as trusted authorities and require that the peer present a certificate with a valid chain anchored by one of those authorities.</p>
<p>A server can use this to verify that a client provides a valid certificate signed by one of those certificate authorities; here is an example of such a certificate.</p>
<p><a class="reference download internal" download="" href="../../_downloads/f8a2672793b7ee37d486a5ec4f31a0fb/ssl_clientauth_server.py"><code class="xref download docutils literal notranslate"><span class="pre">ssl_clientauth_server.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># Copyright (c) Twisted Matrix Laboratories.</span>
<span class="c1"># See LICENSE for details.</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">echoserv</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.python</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">twisted.python.modules</span> <span class="kn">import</span> <span class="n">getModule</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">startLogging</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">certData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;public.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">authData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;server.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">authority</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">Certificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">certData</span><span class="p">)</span>
    <span class="n">certificate</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PrivateCertificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">authData</span><span class="p">)</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Factory</span><span class="o">.</span><span class="n">forProtocol</span><span class="p">(</span><span class="n">echoserv</span><span class="o">.</span><span class="n">Echo</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">listenSSL</span><span class="p">(</span><span class="mi">8000</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">certificate</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">authority</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl_clientauth_server</span>

    <span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">ssl_clientauth_server</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="client-with-certificates">
<h3>Client with certificates<a class="headerlink" href="#client-with-certificates" title="Permalink to this headline"></a></h3>
<p>The following client then supplies such a certificate as the <code class="docutils literal notranslate"><span class="pre">clientCertificate</span></code> argument to <code class="xref py py-func docutils literal notranslate"><span class="pre">optionsForClientTLS</span></code>, while still validating the server’s identity.</p>
<p><a class="reference download internal" download="" href="../../_downloads/41be9ae3cd46419798d77bc7dbb1853b/ssl_clientauth_client.py"><code class="xref download docutils literal notranslate"><span class="pre">ssl_clientauth_client.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># Copyright (c) Twisted Matrix Laboratories.</span>
<span class="c1"># See LICENSE for details.</span>

<span class="kn">import</span> <span class="nn">echoclient</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">ssl</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.python.modules</span> <span class="kn">import</span> <span class="n">getModule</span>


<span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Factory</span><span class="o">.</span><span class="n">forProtocol</span><span class="p">(</span><span class="n">echoclient</span><span class="o">.</span><span class="n">EchoClient</span><span class="p">)</span>
    <span class="n">certData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;public.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">authData</span> <span class="o">=</span> <span class="n">getModule</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">filePath</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s2">&quot;server.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
    <span class="n">clientCertificate</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PrivateCertificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">authData</span><span class="p">)</span>
    <span class="n">authority</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">Certificate</span><span class="o">.</span><span class="n">loadPEM</span><span class="p">(</span><span class="n">certData</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">optionsForClientTLS</span><span class="p">(</span><span class="s2">&quot;example.com&quot;</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">clientCertificate</span><span class="p">)</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">SSL4ClientEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">echoClient</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>

    <span class="n">done</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>
    <span class="n">echoClient</span><span class="o">.</span><span class="n">connectionLost</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">reason</span><span class="p">:</span> <span class="n">done</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">done</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl_clientauth_client</span>

    <span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">ssl_clientauth_client</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that these two examples are very, very similar to the TLS echo examples above.
In fact, you can demonstrate a failed authentication by simply running <code class="docutils literal notranslate"><span class="pre">echoclient_ssl.py</span></code> against <code class="docutils literal notranslate"><span class="pre">ssl_clientauth_server.py</span></code>; you’ll see no output because the server closed the connection rather than echoing the client’s authenticated input.</p>
</section>
<section id="tls-protocol-options">
<h3>TLS Protocol Options<a class="headerlink" href="#tls-protocol-options" title="Permalink to this headline"></a></h3>
<p>For servers, it is desirable to offer Diffie-Hellman based key exchange that provides perfect forward secrecy.
The ciphers are activated by default, however it is necessary to pass an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">DiffieHellmanParameters</span></code> to <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> via the <code class="docutils literal notranslate"><span class="pre">dhParameters</span></code> option to be able to use them.</p>
<p>For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.ssl</span> <span class="kn">import</span> <span class="n">CertificateOptions</span><span class="p">,</span> <span class="n">DiffieHellmanParameters</span>
<span class="kn">from</span> <span class="nn">twisted.python.filepath</span> <span class="kn">import</span> <span class="n">FilePath</span>
<span class="n">dhFilePath</span> <span class="o">=</span> <span class="n">FilePath</span><span class="p">(</span><span class="s1">&#39;dh_param_1024.pem&#39;</span><span class="p">)</span>
<span class="n">dhParams</span> <span class="o">=</span> <span class="n">DiffieHellmanParameters</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">dhFilePath</span><span class="p">)</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">CertificateOptions</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">dhParameters</span><span class="o">=</span><span class="n">dhParams</span><span class="p">)</span>
</pre></div>
</div>
<p>Another part of the TLS protocol which <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> can control is the version of the TLS or SSL protocol used.
By default, Twisted will configure it to use TLSv1.2 or later and disable the insecure SSLv3 protocol.
Manual control over protocols can be helpful if you need to support legacy SSLv3 systems, or you wish to restrict it down to just the strongest of the TLS versions.</p>
<p>You can ask <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> to use a more secure default minimum than Twisted’s by using the <code class="docutils literal notranslate"><span class="pre">raiseMinimumTo</span></code> argument in the initializer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.ssl</span> <span class="kn">import</span> <span class="n">CertificateOptions</span><span class="p">,</span> <span class="n">TLSVersion</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">CertificateOptions</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">raiseMinimumTo</span><span class="o">=</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">TLSv1_3</span><span class="p">)</span>
</pre></div>
</div>
<p>This will always negotiate a minimum of TLSv1.3, but will negotiate higher versions if Twisted’s default is higher.
This usage will stay secure if Twisted updates the minimum to some hypothetical future TLS version, rather than causing your application to use the now theoretically insecure minimum you set.</p>
<p>If you need a strictly hard range of TLS versions you wish <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> to negotiate, you can use the <code class="docutils literal notranslate"><span class="pre">insecurelyLowerMinimumTo</span></code> and <code class="docutils literal notranslate"><span class="pre">lowerMaximumSecurityTo</span></code> arguments in the initializer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.ssl</span> <span class="kn">import</span> <span class="n">CertificateOptions</span><span class="p">,</span> <span class="n">TLSVersion</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">CertificateOptions</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">insecurelyLowerMinimumTo</span><span class="o">=</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">TLSv1_0</span><span class="p">,</span>
    <span class="n">lowerMaximumSecurityTo</span><span class="o">=</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">TLSv1_2</span><span class="p">)</span>
</pre></div>
</div>
<p>This will cause it to negotiate between TLSv1.0 and TLSv1.2, and will not change if Twisted’s default minimum TLS version is raised.
Note that this may not work at all, due to your version of OpenSSL potentially limiting the availability of deprecated or broken TLS versions.
It is highly recommended not to set <code class="docutils literal notranslate"><span class="pre">lowerMaximumSecurityTo</span></code> unless you have a peer that is known to misbehave on newer TLS versions, and to only set <code class="docutils literal notranslate"><span class="pre">insecurelyLowerMinimumTo</span></code> when Twisted’s minimum is not acceptable.
Using these two arguments to <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code> may make your application’s TLS insecure if you do not review it frequently, and should not be used in libraries.</p>
<p>SSLv3 support is still available and you can enable support for it if you wish.
As an example, this supports all TLS versions and SSLv3:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.ssl</span> <span class="kn">import</span> <span class="n">CertificateOptions</span><span class="p">,</span> <span class="n">TLSVersion</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">CertificateOptions</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">insecurelyLowerMinimumTo</span><span class="o">=</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">SSLv3</span><span class="p">)</span>
</pre></div>
</div>
<p>Future OpenSSL versions may completely remove the ability to negotiate the insecure SSLv3 protocol, and this will not allow you to re-enable it.</p>
<p>Additionally, it is possible to limit the acceptable ciphers for your connection by passing an <code class="xref py py-class docutils literal notranslate"><span class="pre">IAcceptableCiphers</span></code> object to <code class="docutils literal notranslate"><span class="pre">CertificateOptions</span></code>.
Since Twisted uses a secure cipher configuration by default, it is discouraged to do so unless absolutely necessary.</p>
</section>
</section>
<section id="application-layer-protocol-negotiation-alpn-and-next-protocol-negotiation-npn">
<h2>Application Layer Protocol Negotiation (ALPN) and Next Protocol Negotiation (NPN)<a class="headerlink" href="#application-layer-protocol-negotiation-alpn-and-next-protocol-negotiation-npn" title="Permalink to this headline"></a></h2>
<p>ALPN and NPN are TLS extensions that can be used by clients and servers to negotiate what application-layer protocol will be spoken once the encrypted connection is established.
This avoids the need for extra custom round trips once the encrypted connection is established. It is implemented as a standard part of the TLS handshake.</p>
<p>NPN is supported from OpenSSL version 1.0.1.
ALPN is the newer of the two protocols, supported in OpenSSL versions 1.0.2 onward.
These functions require pyOpenSSL version 0.15 or higher.
To query the methods supported by your system,  use <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.internet.ssl.protocolNegotiationMechanisms()</span></code>.
It will return a collection of flags indicating support for NPN and/or ALPN.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.ssl.CertificateOptions</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.internet.ssl.optionsForClientTLS()</span></code> allow for selecting the protocols your program is willing to speak after the connection is established.</p>
<p>On the server-side you will have:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.ssl</span> <span class="kn">import</span> <span class="n">CertificateOptions</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">CertificateOptions</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">acceptableProtocols</span><span class="o">=</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;h2&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;http/1.1&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>and for clients:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.ssl</span> <span class="kn">import</span> <span class="n">optionsForClientTLS</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">optionsForClientTLS</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span> <span class="n">acceptableProtocols</span><span class="o">=</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;h2&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;http/1.1&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Twisted will attempt to use both ALPN and NPN, if they’re available, to maximise compatibility with peers.
If both ALPN and NPN are supported by the peer, the result from ALPN is preferred.</p>
<p>For NPN, the client selects the protocol to use;
For ALPN, the server does.
If Twisted is acting as the peer who is supposed to select the protocol, it will prefer the earliest protocol in the list that is supported by both peers.</p>
<p>To determine what protocol was negotiated, after the connection is done,  use <code class="xref py py-attr docutils literal notranslate"><span class="pre">TLSMemoryBIOProtocol.negotiatedProtocol</span></code>.
It will return one of the protocol names passed to the <code class="docutils literal notranslate"><span class="pre">acceptableProtocols</span></code> parameter.
It will return <code class="docutils literal notranslate"><span class="pre">None</span></code> if the peer did not offer ALPN or NPN.</p>
<p>It can also return <code class="docutils literal notranslate"><span class="pre">None</span></code> if no overlap could be found and the connection was established regardless (some peers will do this: Twisted will not).
In this case, the protocol that should be used is whatever protocol would have been used if negotiation had not been attempted at all.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If ALPN or NPN are used and no overlap can be found, then the remote peer may choose to terminate the connection.
This may cause the TLS handshake to fail, or may result in the connection being torn down immediately after being made.
If Twisted is the selecting peer (that is, Twisted is the server and ALPN is being used, or Twisted is the client and NPN is being used), and no overlap can be found, Twisted will always choose to fail the handshake rather than allow an ambiguous connection to set up.</p>
</div>
<p>An example of using this functionality can be found in <a class="reference download internal" download="" href="../../_downloads/321b0b9c31454b7933ebceb9b73f4dd9/tls_alpn_npn_client.py"><code class="xref download docutils literal notranslate"><span class="pre">this</span> <span class="pre">example</span> <span class="pre">script</span> <span class="pre">for</span> <span class="pre">clients</span></code></a> and <a class="reference download internal" download="" href="../../_downloads/ea62c1b88efac953212dacf72cc26d3d/tls_alpn_npn_server.py"><code class="xref download docutils literal notranslate"><span class="pre">this</span> <span class="pre">example</span> <span class="pre">script</span> <span class="pre">for</span> <span class="pre">servers</span></code></a>.</p>
</section>
<section id="related-facilities">
<h2>Related facilities<a class="headerlink" href="#related-facilities" title="Permalink to this headline"></a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.protocols.amp</span></code> supports encrypted
connections and exposes a <code class="docutils literal notranslate"><span class="pre">startTLS</span></code> method one can use or
subclass. <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.web</span></code> has built-in TLS support in
its <code class="xref py py-mod docutils literal notranslate"><span class="pre">client</span></code> , <code class="xref py py-mod docutils literal notranslate"><span class="pre">http</span></code> , and <code class="xref py py-mod docutils literal notranslate"><span class="pre">xmlrpc</span></code> modules.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline"></a></h2>
<p>After reading through this tutorial, you should be able to:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">listenSSL</span></code> and <code class="docutils literal notranslate"><span class="pre">connectSSL</span></code> to create servers and clients that use
TLS</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">startTLS</span></code> to switch a channel from being unencrypted to using TLS
mid-connection</p></li>
<li><p>Add server and client support for client authentication</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="reactor-basics.html" class="btn btn-neutral float-left" title="Reactor Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="udp.html" class="btn btn-neutral float-right" title="UDP Networking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>