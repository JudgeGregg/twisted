<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing a twistd Plugin &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deploying Twisted with systemd" href="systemd.html" />
    <link rel="prev" title="Using the Twisted Application Framework" href="application.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vision.html">The Vision For Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="servers.html">Writing Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="clients.html">Writing Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="trial.html">Test-driven development with Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/index.html">Twisted from Scratch, or The Evolution of Finger</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/intro.html">The Evolution of Finger: building a simple finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/protocol.html">The Evolution of Finger: adding features to the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/style.html">The Evolution of Finger: cleaning up the finger code</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/components.html">The Evolution of Finger: moving to a component based architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/backends.html">The Evolution of Finger: pluggable backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/web.html">The Evolution of Finger: a web frontend</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/pb.html">The Evolution of Finger: Twisted client support using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/factory.html">The Evolution of Finger: using a single factory for multiple protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/client.html">The Evolution of Finger: a Twisted finger client</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/library.html">The Evolution of Finger: making a finger library</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/configuration.html">The Evolution of Finger: configuration of the finger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="quotes.html">Setting up the TwistedQuotes application</a></li>
<li class="toctree-l3"><a class="reference internal" href="design.html">Designing Twisted Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="internet-overview.html">Overview of Twisted Internet</a></li>
<li class="toctree-l3"><a class="reference internal" href="reactor-basics.html">Reactor Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl.html">Using TLS in Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="udp.html">UDP Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="process.html">Using Processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer-intro.html">Introduction to Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer.html">Deferred Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="gendefer.html">Generating Deferreds</a></li>
<li class="toctree-l3"><a class="reference internal" href="time.html">Scheduling tasks for the future</a></li>
<li class="toctree-l3"><a class="reference internal" href="threading.html">Using Threads in Twisted</a></li>
<li class="toctree-l3"><a class="reference internal" href="producers.html">Producers and Consumers: Efficient High-Volume Streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="choosing-reactor.html">Choosing a Reactor and GUI Toolkit Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="endpoints.html">Getting Connected with Endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="components.html">Components: Interfaces and Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cred.html">Cred: Pluggable Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin.html">The Twisted Plugin System</a></li>
<li class="toctree-l3"><a class="reference internal" href="basics.html">The Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="application.html">Using the Twisted Application Framework</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Writing a twistd Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#goals">Goals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternatives-to-twistd-plugins">Alternatives to twistd Plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-plugin">Creating the Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-cred-with-your-tap">Using <code class="docutils literal notranslate"><span class="pre">cred</span></code> with your TAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploy-your-application-using-python-packages">Deploy your Application Using Python Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="systemd.html">Deploying Twisted with systemd</a></li>
<li class="toctree-l3"><a class="reference internal" href="logger.html">Logging with twisted.logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">Twisted’s Legacy Logging System: <code class="docutils literal notranslate"><span class="pre">twisted.python.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="constants.html">Symbolic Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="rdbms.html">twisted.enterprise.adbapi: Twisted RDBMS support</a></li>
<li class="toctree-l3"><a class="reference internal" href="options.html">Parsing command-lines with usage.Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="dirdbm.html">DirDBM: Directory-based Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Writing tests for Twisted code using Trial</a></li>
<li class="toctree-l3"><a class="reference internal" href="sendmsg.html">Extremely Low-Level Socket Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="amp.html">Asynchronous Messaging Protocol Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb.html">Overview of Twisted Spread</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-intro.html">Introduction to Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-usage.html">Using Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-clients.html">Managing Clients of Perspectives</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-copyable.html">PB Copyable: Passing Complex Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-cred.html">Authentication with Perspective Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="pb-limits.html">PB Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html">Porting to Python 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="positioning.html">Twisted Positioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Twisted Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="debug-with-emacs.html">Debugging Python(Twisted) with Emacs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specifications/index.html">Specifications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../names/index.html">Twisted Names (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Core</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>Writing a twistd Plugin</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/core/howto/tap.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="writing-a-twistd-plugin">
<h1>Writing a twistd Plugin<a class="headerlink" href="#writing-a-twistd-plugin" title="Permalink to this headline"></a></h1>
<p>This document describes adding subcommands to the <code class="docutils literal notranslate"><span class="pre">twistd</span></code> command,
as a way to facilitate the deployment of your applications.</p>
<p>The target audience of this document are those that have developed a Twisted application which needs a command line-based deployment mechanism.</p>
<p>There are a few prerequisites to understanding this document:</p>
<ul class="simple">
<li><p>A basic understanding of the Twisted Plugin System (i.e., the <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.plugin</span></code> module) is necessary,
however, step-by-step instructions will be given.
Reading <a class="reference internal" href="plugin.html"><span class="doc">The Twisted Plugin System</span></a> is recommended,
in particular the “Extending an Existing Program” section.</p></li>
<li><p>The <a class="reference internal" href="application.html"><span class="doc">Application</span></a> infrastructure is used in <code class="docutils literal notranslate"><span class="pre">twistd</span></code> plugins;
in particular, you should know how to expose your program’s functionality as a Service.</p></li>
<li><p>In order to parse command line arguments, the <code class="docutils literal notranslate"><span class="pre">twistd</span></code> plugin mechanism relies on <code class="docutils literal notranslate"><span class="pre">twisted.python.usage</span></code> ,
which is documented in <a class="reference internal" href="options.html"><span class="doc">Using usage.Options</span></a> .</p></li>
</ul>
<section id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline"></a></h2>
<p>After reading this document,
the reader should be able to expose their Service-using application as a subcommand of <code class="docutils literal notranslate"><span class="pre">twistd</span></code> ,
taking into consideration whatever was passed on the command line.</p>
</section>
<section id="alternatives-to-twistd-plugins">
<h2>Alternatives to twistd Plugins<a class="headerlink" href="#alternatives-to-twistd-plugins" title="Permalink to this headline"></a></h2>
<p>The major alternative to the twistd plugin mechanism is the <code class="docutils literal notranslate"><span class="pre">.tac</span></code> file,
which is a simple script to be used with the twistd <code class="docutils literal notranslate"><span class="pre">-y/--python</span></code> parameter.
The twistd plugin mechanism exists to offer a more extensible command-line-driven interface to your application.
For more information on <code class="docutils literal notranslate"><span class="pre">.tac</span></code> files,
see the document <a class="reference internal" href="application.html"><span class="doc">Using the Twisted Application Framework</span></a> .</p>
</section>
<section id="creating-the-plugin">
<h2>Creating the Plugin<a class="headerlink" href="#creating-the-plugin" title="Permalink to this headline"></a></h2>
<p>The following directory structure is assumed of your project:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MyProject</span></code> - Top level directory</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">myproject</span></code> - Python package</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>During development of your project,
Twisted plugins can be loaded from a special directory in your project,
assuming your top level directory ends up in <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.path" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a>.
Create a directory named <code class="docutils literal notranslate"><span class="pre">twisted</span></code> containing a directory named <code class="docutils literal notranslate"><span class="pre">plugins</span></code> ,
and add a file named <code class="docutils literal notranslate"><span class="pre">myproject_plugin.py</span></code> to it.
This file will contain your plugin.
Note that you must <em>not</em> add any <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> files to this directory structure,
and the plugin file should <em>not</em> be named <code class="docutils literal notranslate"><span class="pre">myproject.py</span></code>
(because that would conflict with your project’s module name).</p>
<p>In this file, define an object which <em>provides</em> the interfaces <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.plugin.IPlugin</span></code>
and <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.application.service.IServiceMaker</span></code> .</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tapname</span></code> attribute of your IServiceMaker provider will be used as the subcommand name in a command like <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">[subcommand]</span> <span class="pre">[args...]</span></code> ,
and the <code class="docutils literal notranslate"><span class="pre">options</span></code> attribute
(which should be a <code class="xref py py-class docutils literal notranslate"><span class="pre">usage.Options</span></code> subclass)
will be used to parse the given args.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>

<span class="kn">from</span> <span class="nn">twisted.python</span> <span class="kn">import</span> <span class="n">usage</span>
<span class="kn">from</span> <span class="nn">twisted.plugin</span> <span class="kn">import</span> <span class="n">IPlugin</span>
<span class="kn">from</span> <span class="nn">twisted.application.service</span> <span class="kn">import</span> <span class="n">IServiceMaker</span>
<span class="kn">from</span> <span class="nn">twisted.application</span> <span class="kn">import</span> <span class="n">internet</span>

<span class="kn">from</span> <span class="nn">myproject</span> <span class="kn">import</span> <span class="n">MyFactory</span>


<span class="k">class</span> <span class="nc">Options</span><span class="p">(</span><span class="n">usage</span><span class="o">.</span><span class="n">Options</span><span class="p">):</span>
    <span class="n">optParameters</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="mi">1235</span><span class="p">,</span> <span class="s2">&quot;The port number to listen on.&quot;</span><span class="p">]]</span>


<span class="nd">@implementer</span><span class="p">(</span><span class="n">IServiceMaker</span><span class="p">,</span> <span class="n">IPlugin</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyServiceMaker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">tapname</span> <span class="o">=</span> <span class="s2">&quot;myproject&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Run this! It&#39;ll make your dog happy.&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span>

    <span class="k">def</span> <span class="nf">makeService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a TCPServer from a factory defined in myproject.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">internet</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]),</span> <span class="n">MyFactory</span><span class="p">())</span>


<span class="c1"># Now construct an object which *provides* the relevant interfaces</span>
<span class="c1"># The name of this variable is irrelevant, as long as there is *some*</span>
<span class="c1"># name bound to a provider of IPlugin and IServiceMaker.</span>
<span class="n">serviceMaker</span> <span class="o">=</span> <span class="n">MyServiceMaker</span><span class="p">()</span>
</pre></div>
</div>
<p>Now running <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">--help</span></code> should print <code class="docutils literal notranslate"><span class="pre">myproject</span></code> in the list of available subcommands,
followed by the description that we specified in the plugin.
<code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">-n</span> <span class="pre">myproject</span></code> would,
assuming we defined a <code class="docutils literal notranslate"><span class="pre">MyFactory</span></code> factory inside <code class="docutils literal notranslate"><span class="pre">myproject</span></code> ,
start a listening server on port 1235 with that factory.</p>
</section>
<section id="using-cred-with-your-tap">
<h2>Using <code class="docutils literal notranslate"><span class="pre">cred</span></code> with your TAP<a class="headerlink" href="#using-cred-with-your-tap" title="Permalink to this headline"></a></h2>
<p>Twisted ships with a robust authentication framework to use with your application.
If your server needs authentication functionality,
and you haven’t read about <a class="reference internal" href="cred.html"><span class="doc">twisted.cred</span></a> yet,
read up on it first.</p>
<p>If you are building a twistd plugin and you want to support a wide variety of authentication patterns,
Twisted provides an easy-to-use mixin for your Options subclass:
<code class="xref py py-class docutils literal notranslate"><span class="pre">strcred.AuthOptionMixin</span></code> .
The following code is an example of using this mixin:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.cred</span> <span class="kn">import</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">portal</span><span class="p">,</span> <span class="n">strcred</span>
<span class="kn">from</span> <span class="nn">twisted.python</span> <span class="kn">import</span> <span class="n">usage</span>
<span class="kn">from</span> <span class="nn">twisted.plugin</span> <span class="kn">import</span> <span class="n">IPlugin</span>
<span class="kn">from</span> <span class="nn">twisted.application.service</span> <span class="kn">import</span> <span class="n">IServiceMaker</span>
<span class="kn">from</span> <span class="nn">myserver</span> <span class="kn">import</span> <span class="n">myservice</span>


<span class="k">class</span> <span class="nc">ServerOptions</span><span class="p">(</span><span class="n">usage</span><span class="o">.</span><span class="n">Options</span><span class="p">,</span> <span class="n">strcred</span><span class="o">.</span><span class="n">AuthOptionMixin</span><span class="p">):</span>
    <span class="c1"># This part is optional; it tells AuthOptionMixin what</span>
    <span class="c1"># kinds of credential interfaces the user can give us.</span>
    <span class="n">supportedInterfaces</span> <span class="o">=</span> <span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">IUsernamePassword</span><span class="p">,)</span>

    <span class="n">optParameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="s2">&quot;Server port number&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;Server hostname&quot;</span><span class="p">]]</span>


<span class="nd">@implementer</span><span class="p">(</span><span class="n">IServiceMaker</span><span class="p">,</span> <span class="n">IPlugin</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyServerServiceMaker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">tapname</span> <span class="o">=</span> <span class="s2">&quot;myserver&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;This server does nothing productive.&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">ServerOptions</span>

    <span class="k">def</span> <span class="nf">makeService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a service object.&quot;&quot;&quot;</span>
        <span class="c1"># The realm is a custom object that your server defines.</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="n">myservice</span><span class="o">.</span><span class="n">MyServerRealm</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">])</span>

        <span class="c1"># The portal is something Cred can provide, as long as</span>
        <span class="c1"># you have a list of checkers that you&#39;ll support. This</span>
        <span class="c1"># list is provided my AuthOptionMixin.</span>
        <span class="n">portal</span> <span class="o">=</span> <span class="n">portal</span><span class="o">.</span><span class="n">Portal</span><span class="p">(</span><span class="n">realm</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;credCheckers&quot;</span><span class="p">])</span>

        <span class="c1"># OR, if you know you might get multiple interfaces, and</span>
        <span class="c1"># only want to give your application one of them, you</span>
        <span class="c1"># also have that option with AuthOptionMixin:</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">IUsernamePassword</span>
        <span class="n">portal</span> <span class="o">=</span> <span class="n">portal</span><span class="o">.</span><span class="n">Portal</span><span class="p">(</span><span class="n">realm</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;credInterfaces&quot;</span><span class="p">][</span><span class="n">interface</span><span class="p">])</span>

        <span class="c1"># The protocol factory is, like the realm, something you implement.</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">myservice</span><span class="o">.</span><span class="n">ServerFactory</span><span class="p">(</span><span class="n">realm</span><span class="p">,</span> <span class="n">portal</span><span class="p">)</span>

        <span class="c1"># Finally, return a service that will listen for connections.</span>
        <span class="k">return</span> <span class="n">internet</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]),</span> <span class="n">factory</span><span class="p">)</span>


<span class="c1"># As in our example above, we have to construct an object that</span>
<span class="c1"># provides the IPlugin and IServiceMaker interfaces.</span>
<span class="n">serviceMaker</span> <span class="o">=</span> <span class="n">MyServerServiceMaker</span><span class="p">()</span>
</pre></div>
</div>
<p>Now that you have your TAP configured to support any authentication we can throw at it,
you’re ready to use it.
Here is an example of starting your server using the <code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code> file for authentication.
(Clearly, this won’t work on servers with shadow passwords.)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>twistd myserver --auth passwd:/etc/passwd
</pre></div>
</div>
<p>For a full list of cred plugins supported,
see <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.plugins</span></code> ,
or use the command-line help:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>twistd myserver --help-auth
<span class="gp">$ </span>twistd myserver --help-auth-type passwd
</pre></div>
</div>
</section>
<section id="deploy-your-application-using-python-packages">
<h2>Deploy your Application Using Python Packages<a class="headerlink" href="#deploy-your-application-using-python-packages" title="Permalink to this headline"></a></h2>
<p>To deploy your application one possibility is to wrap it up in a Python package.
For this you need to write a special file <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, which contains metadata
of the package. You would have to extend the layout of your files like this:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MyProject</span></code> - Top level directory</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">setup.py</span></code> - Description file for the package</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">myproject</span></code> - Python package</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">twisted</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">plugins</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">myproject_plugins.py</span></code> - Dropin file containing the actual plugin</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">a minimal <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file</span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyApplication&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.1dev&#39;</span><span class="p">,</span>
    <span class="c1"># it is necesary to extend the found package list with the twisted.plugin</span>
    <span class="c1"># directory. It cannot be automatically detected, because it should not</span>
    <span class="c1"># contain a __init__.py file.</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;twisted.plugins&#39;</span><span class="p">],</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;twisted&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>To create the Python package from the directory the standard setup tools can be used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 setup.py sdist
</pre></div>
</div>
<p>This command creates a <code class="docutils literal notranslate"><span class="pre">dist</span></code> directory in your project folder with the
compressed archive file <code class="docutils literal notranslate"><span class="pre">MyApplication-0.1dev.tar.gz</span></code>. This archive contains
all the code and additional files if specified. This file can be copied and used
for deployment.</p>
<p>To install the application just use pip. It will also install all requirements
specified in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install MyApplication-0.1dev.tar.gz
</pre></div>
</div>
<p>For more information about packaging in Python have a look at the <a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/">official
Python packaging user guide</a> or
<a class="reference external" href="https://the-hitchhikers-guide-to-packaging.readthedocs.io/">hitchhiker’s guide to packaging</a>.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline"></a></h2>
<p>You should now be able to</p>
<ul class="simple">
<li><p>Create a twistd plugin</p></li>
<li><p>Incorporate authentication into your plugin</p></li>
<li><p>Use it from your development environment</p></li>
<li><p>Install it correctly and use it in deployment</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="application.html" class="btn btn-neutral float-left" title="Using the Twisted Application Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="systemd.html" class="btn btn-neutral float-right" title="Deploying Twisted with systemd" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>