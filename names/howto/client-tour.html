<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A Guided Tour of twisted.names.client &mdash; Twisted 22.8.0.post0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" defer hack=""></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Creating and working with a names (DNS) server" href="names.html" />
    <link rel="prev" title="Developer Guides" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Twisted
          </a>
              <div class="version">
                22.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installing Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Twisted Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conch/index.html">Twisted Conch (SSH and Telnet)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mail/index.html">Twisted Mail (SMTP, POP, and IMAP)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Twisted Names (DNS)</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">A Guided Tour of twisted.names.client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-the-global-resolver">Using the Global Resolver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-new-resolver">Creating a New Resolver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-a-resolver-in-the-reactor">Installing a Resolver in the Reactor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lower-level-apis">Lower Level APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="names.html">Creating and working with a names (DNS) server</a></li>
<li class="toctree-l3"><a class="reference internal" href="custom-server.html">Creating a custom server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pair/index.html">Twisted Pair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Twisted Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../words/index.html">Twisted Words (IRC and XMPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development of Twisted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sponsors/index.html">Sponsors of Twisted</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../historic/index.html">Historical Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Report a security issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-procedure-for-developers">Security Procedure for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html#security-audit">Security Audit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Twisted Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/twisted/twisted">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/twisted">PyPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Twisted</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Twisted Names (DNS)</a> &raquo;</li>
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      <li>A Guided Tour of twisted.names.client</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/names/howto/client-tour.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-guided-tour-of-twisted-names-client">
<h1>A Guided Tour of twisted.names.client<a class="headerlink" href="#a-guided-tour-of-twisted-names-client" title="Permalink to this headline"></a></h1>
<p>Twisted Names provides a layered selection of client APIs.</p>
<p>In this section you will learn:</p>
<ul class="simple">
<li><p>about the high level <code class="xref py py-mod docutils literal notranslate"><span class="pre">client</span></code> API,</p></li>
<li><p>about how you can use the client API interactively from the Python shell (useful for DNS debugging and diagnostics),</p></li>
<li><p>about the <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolverSimple</span></code> and the <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolver</span></code> interfaces,</p></li>
<li><p>about various implementations of those interfaces and when to use them,</p></li>
<li><p>how to customise how the reactor carries out hostname resolution,</p></li>
<li><p>and finally, you will also be introduced to some of the low level APIs.</p></li>
</ul>
<section id="using-the-global-resolver">
<h2>Using the Global Resolver<a class="headerlink" href="#using-the-global-resolver" title="Permalink to this headline"></a></h2>
<p>The easiest way to issue DNS queries from Twisted is to use the module level functions in <code class="xref py py-mod docutils literal notranslate"><span class="pre">names.client</span></code>.</p>
<p>Here’s an example showing some DNS queries generated in an interactive <code class="docutils literal notranslate"><span class="pre">twisted.conch</span></code> shell.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">twisted.conch</span></code> shell starts a <code class="docutils literal notranslate"><span class="pre">reactor</span></code> so that asynchronous operations can be run interactively and it prints the current result of <code class="docutils literal notranslate"><span class="pre">deferred</span></code>s which have fired.</p>
<p>You’ll notice that the <code class="docutils literal notranslate"><span class="pre">deferred</span></code>s returned in the following examples do not immediately have a result – they are waiting for a response from the DNS server.</p>
<p>So we type <code class="docutils literal notranslate"><span class="pre">_</span></code> (the default variable) a little later, to display the value of the <code class="docutils literal notranslate"><span class="pre">deferred</span></code> after an answer has been received and the <code class="docutils literal notranslate"><span class="pre">deferred</span></code> has fired.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m twisted.conch.stdio
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">twisted.names</span> <span class="kn">import</span> <span class="n">client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">getHostByName</span><span class="p">(</span><span class="s1">&#39;www.example.com&#39;</span><span class="p">)</span>
<span class="go">&lt;Deferred at 0xf5c5a8 waiting on Deferred at 0xf5cb90&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span>
<span class="go">&lt;Deferred at 0xf5c5a8 current result: &#39;2606:2800:220:6d:26bf:1447:1097:aa7&#39;&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">lookupMailExchange</span><span class="p">(</span><span class="s1">&#39;twistedmatrix.com&#39;</span><span class="p">)</span>
<span class="go">&lt;Deferred at 0xf5cd40 waiting on Deferred at 0xf5cea8&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span>
<span class="go">&lt;Deferred at 0xf5cd40 current result: ([&lt;RR name=twistedmatrix.com type=MX class=IN ttl=1s auth=False&gt;], [], [])&gt;</span>
</pre></div>
</div>
<p>All the <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolverSimple</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolver</span></code> methods are asynchronous and therefore return <code class="docutils literal notranslate"><span class="pre">deferred</span></code>s.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">getHostByName</span></code> (part of <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolverSimple</span></code>) returns an IP address whereas <code class="xref py py-func docutils literal notranslate"><span class="pre">lookupMailExchange</span></code> returns three lists of DNS records.
These three lists contain answer records, authority records, and additional records.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">getHostByName</span></code> may return an IPv6 address; unlike its stdlib equivalent (<a class="reference external" href="https://docs.python.org/3/library/socket.html#socket.gethostbyname" title="(in Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.gethostbyname()</span></code></a>)</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">IResolver</span></code> contains separate functions for looking up each of the common DNS record types.</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">IResolver</span></code> includes a lower level <code class="docutils literal notranslate"><span class="pre">query</span></code> function for issuing arbitrary queries.</p></li>
<li><p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">names.client</span></code> module <code class="docutils literal notranslate"><span class="pre">directlyProvides</span></code> both the <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolverSimple</span></code> and the <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolver</span></code> interfaces.</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">createResolver</span></code> constructs a global resolver which performs queries against the same DNS sources and servers used by the underlying operating system.</p>
<p>That is, it will use the DNS server IP addresses found in a local <code class="docutils literal notranslate"><span class="pre">resolv.conf</span></code> file (if the operating system provides such a file) and it will use an OS specific <code class="docutils literal notranslate"><span class="pre">hosts</span></code> file path.</p>
</li>
</ul>
</div>
<section id="a-simple-example">
<h3>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline"></a></h3>
<p>In this section you will learn how the <code class="xref py py-class docutils literal notranslate"><span class="pre">IResolver</span></code> interface can be used to write a utility for performing a <a class="reference external" href="https://en.wikipedia.org/wiki/Reverse_DNS_lookup">reverse DNS lookup</a> for an IPv4 address.
<a class="reference external" href="https://en.wikipedia.org/wiki/Dig_(command)">dig</a> can do this too, so lets start by examining its output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig -x <span class="m">127</span>.0.0.1
<span class="go">...</span>
<span class="go">;; QUESTION SECTION:</span>
<span class="go">;1.0.0.127.in-addr.arpa.             IN      PTR</span>

<span class="go">;; ANSWER SECTION:</span>
<span class="go">1.0.0.127.in-addr.arpa.      86400   IN      PTR     localhost.</span>
<span class="go">...</span>
</pre></div>
</div>
<p>As you can see, <code class="docutils literal notranslate"><span class="pre">dig</span></code> has performed a DNS query with the following attributes:</p>
<ul class="simple">
<li><p>Name: <code class="docutils literal notranslate"><span class="pre">1.0.0.127.in-addr.arpa.</span></code></p></li>
<li><p>Class: <code class="docutils literal notranslate"><span class="pre">IN</span></code></p></li>
<li><p>Type: <code class="docutils literal notranslate"><span class="pre">PTR</span></code></p></li>
</ul>
<p>The <em>name</em> is a <strong>reverse domain name</strong> and is derived by reversing an IPv4 address and prepending it to the special <em>in-addr.arpa</em> parent domain name.
So, lets write a function to create a reverse domain name from an IP address.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reverseNameFromIPAddress</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;.in-addr.arpa&quot;</span>
</pre></div>
</div>
<p>We can test the output from a python shell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reverseNameFromIPAddress</span><span class="p">(</span><span class="s1">&#39;192.0.2.100&#39;</span><span class="p">)</span>
<span class="go">&#39;100.2.0.192.in-addr.arpa&#39;</span>
</pre></div>
</div>
<p>We’re going to use <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.names.client.lookupPointer()</span></code> to perform the actual DNS lookup.
So lets examine the output of <code class="docutils literal notranslate"><span class="pre">lookupPointer</span></code> so that we can design a function to format and print its results in a style similar to <code class="docutils literal notranslate"><span class="pre">dig</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">lookupPointer</span></code> is an asynchronous function, so we’ll use an interactive <code class="docutils literal notranslate"><span class="pre">twisted.conch</span></code> shell here.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m twisted.conch.stdio
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">twisted.names</span> <span class="kn">import</span> <span class="n">client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">reverse_lookup</span> <span class="kn">import</span> <span class="n">reverseNameFromIPAddress</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">lookupPointer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">reverseNameFromIPAddress</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">&lt;Deferred at 0x286b170 current result: ([&lt;RR name=1.0.0.127.in-addr.arpa type=PTR class=IN ttl=86400s auth=False&gt;], [], [])&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">result</span>
<span class="go">([&lt;RR name=1.0.0.127.in-addr.arpa type=PTR class=IN ttl=86400s auth=False&gt;], [], [])</span>
</pre></div>
</div>
<p>The deferred result of <code class="docutils literal notranslate"><span class="pre">lookupPointer</span></code> is a tuple containing three lists of records; <strong>answers</strong>, <strong>authority</strong>, and <strong>additional</strong>.
The actual record is a <code class="xref py py-class docutils literal notranslate"><span class="pre">Record_PTR</span></code> instance which can be reached via the <code class="xref py py-class docutils literal notranslate"><span class="pre">RRHeader</span></code><code class="docutils literal notranslate"><span class="pre">.payload</span></code> attribute.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recordHeader</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recordHeader</span><span class="o">.</span><span class="n">payload</span>
<span class="go">&lt;PTR name=localhost ttl=86400&gt;</span>
</pre></div>
</div>
<p>So, now we’ve found the information we need, lets create a function that extracts the first <em>answer</em> and prints the domain name and the record payload.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">printResult</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="n">answers</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">additional</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">if</span> <span class="n">answers</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">answers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> IN </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And lets test the output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt; from twisted.names import dns</span>
<span class="go">&gt;&gt;&gt; printResult(([dns.RRHeader(name=&#39;1.0.0.127.in-addr.arpa&#39;, type=dns.PTR, payload=dns.Record_PTR(&#39;localhost&#39;))], [], []))</span>
<span class="go">1.0.0.127.in-addr.arpa IN &lt;PTR name=localhost ttl=None&gt;</span>
</pre></div>
</div>
<p>Fine! Now we can assemble the pieces in a <code class="docutils literal notranslate"><span class="pre">main</span></code> function, which we’ll call using <code class="xref py py-func docutils literal notranslate"><span class="pre">twisted.internet.task.react()</span></code>.
Here’s the complete script.</p>
<p><a class="reference download internal" download="" href="../../_downloads/20b4890bbf5f40c315faa29afd01ac00/reverse_lookup.py"><code class="xref download docutils literal notranslate"><span class="pre">listings/names/reverse_lookup.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.names</span> <span class="kn">import</span> <span class="n">client</span>


<span class="k">def</span> <span class="nf">reverseNameFromIPAddress</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;.in-addr.arpa&quot;</span>


<span class="k">def</span> <span class="nf">printResult</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="n">answers</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">additional</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">if</span> <span class="n">answers</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">answers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> IN </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">lookupPointer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">reverseNameFromIPAddress</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">))</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">printResult</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
<p>The output looks like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python reverse_lookup.py <span class="m">127</span>.0.0.1
<span class="go">1.0.0.127.in-addr.arpa IN &lt;PTR name=localhost ttl=86400&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>You can read more about reverse domain names in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1034.html#section-5.2.1"><strong>RFC 1034#section-5.2.1</strong></a>.</p></li>
<li><p>We’ve ignored IPv6 addresses in this example, but you can read more about reverse IPv6 domain names in <span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3596.html#section-2.5"><strong>RFC 3596#section-2.5</strong></a> and the example could easily be extended to support these.</p></li>
<li><p>You might also consider using <a class="reference external" href="https://pypi.python.org/pypi/netaddr/">netaddr</a>,  which can generate reverse domain names and which also includes sophisticated IP network and IP address handling.</p></li>
<li><p>This script only prints the first answer, but sometimes you’ll get multiple answers due to CNAME indirection, for example in the case of classless reverse zones.</p></li>
<li><p>All lookups and responses are handled asynchronously, so the script could be extended to perform thousands of reverse DNS lookups in parallel.</p></li>
</ul>
</div>
<p>Next you should study <a class="reference download internal" download="" href="../../_downloads/78f0b27fa5bab102eabd3ba596a6d46f/multi_reverse_lookup.py"><code class="xref download docutils literal notranslate"><span class="pre">../examples/multi_reverse_lookup.py</span></code></a> which extends this example to perform both IPv4 and IPv6 addresses and which can perform multiple reverse DNS lookups in parallel.</p>
</section>
</section>
<section id="creating-a-new-resolver">
<h2>Creating a New Resolver<a class="headerlink" href="#creating-a-new-resolver" title="Permalink to this headline"></a></h2>
<p>Now suppose we want to create a DNS client which sends its queries to a specific server (or servers).</p>
<p>In this case, we use <code class="xref py py-class docutils literal notranslate"><span class="pre">client.Resolver</span></code> directly and pass it a list of preferred server IP addresses and ports.</p>
<p>For example, suppose we want to lookup names using the free Google DNS servers:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m twisted.conch.stdio
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">twisted.names</span> <span class="kn">import</span> <span class="n">client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resolver</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">createResolver</span><span class="p">(</span><span class="n">servers</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;8.8.8.8&#39;</span><span class="p">,</span> <span class="mi">53</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;8.8.4.4&#39;</span><span class="p">,</span> <span class="mi">53</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resolver</span><span class="o">.</span><span class="n">getHostByName</span><span class="p">(</span><span class="s1">&#39;example.com&#39;</span><span class="p">)</span>
<span class="go">&lt;Deferred at 0x9dcfbac current result: &#39;93.184.216.119&#39;&gt;</span>
</pre></div>
</div>
<p>Here we are using the Google DNS server IP addresses and the standard DNS port (53).</p>
</section>
<section id="installing-a-resolver-in-the-reactor">
<h2>Installing a Resolver in the Reactor<a class="headerlink" href="#installing-a-resolver-in-the-reactor" title="Permalink to this headline"></a></h2>
<p>You can also install a custom resolver into the reactor using the <code class="xref py py-class docutils literal notranslate"><span class="pre">IReactorPluggableNameResolver</span></code> interface.</p>
<p>The reactor uses its installed resolver whenever it needs to resolve hostnames; for example, when you supply a hostname to <code class="xref py py-meth docutils literal notranslate"><span class="pre">connectTCP</span></code>.</p>
<p>Here’s a short example that shows how to install an alternative resolver for the global reactor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.names</span> <span class="kn">import</span> <span class="n">client</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">installResolver</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">createResolver</span><span class="p">(</span><span class="n">servers</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;8.8.8.8&#39;</span><span class="p">,</span> <span class="mi">53</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;8.8.4.4&#39;</span><span class="p">,</span> <span class="mi">53</span><span class="p">)]))</span>
</pre></div>
</div>
<p>After this, all hostname lookups requested by the reactor will be sent to the Google DNS servers; instead of to the local operating system.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>By default the reactor uses the POSIX <code class="docutils literal notranslate"><span class="pre">gethostbyname</span></code> function provided by the operating system,</p></li>
<li><p>but <code class="docutils literal notranslate"><span class="pre">gethostbyname</span></code> is a blocking function, so it has to be called in a thread pool.</p></li>
<li><p>Check out <code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadedResolver</span></code> if you’re interested in learning more about how the default threaded resolver works.</p></li>
</ul>
</div>
</section>
<section id="lower-level-apis">
<h2>Lower Level APIs<a class="headerlink" href="#lower-level-apis" title="Permalink to this headline"></a></h2>
<p>Here’s an example of how to use the <code class="xref py py-class docutils literal notranslate"><span class="pre">DNSDatagramProtocol</span></code> directly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.names</span> <span class="kn">import</span> <span class="n">dns</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">reactor</span><span class="p">):</span>
    <span class="n">proto</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">DNSDatagramProtocol</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">listenUDP</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">proto</span><span class="o">.</span><span class="n">query</span><span class="p">((</span><span class="s1">&#39;8.8.8.8&#39;</span><span class="p">,</span> <span class="mi">53</span><span class="p">),</span> <span class="p">[</span><span class="n">dns</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="s1">&#39;www.example.com&#39;</span><span class="p">,</span> <span class="n">dns</span><span class="o">.</span><span class="n">AAAA</span><span class="p">)])</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">printResult</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">printResult</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ANSWERS: &#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">payload</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">answers</span><span class="p">])</span>

<span class="n">task</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>The disadvantage of working at this low level is that you will need to handle query failures yourself, by manually re-issuing queries or by issuing followup TCP queries using the stream based <code class="xref py py-class docutils literal notranslate"><span class="pre">dns.DNSProtocol</span></code>.</p>
<p>These things are handled automatically by the higher level APIs in <code class="xref py py-mod docutils literal notranslate"><span class="pre">client</span></code>.</p>
<p>Also notice that in this case, the deferred result of <code class="xref py py-class docutils literal notranslate"><span class="pre">dns.DNSDatagramProtocol.query</span></code> is a <code class="xref py py-class docutils literal notranslate"><span class="pre">dns.Message</span></code> object, rather than a list of DNS records.</p>
</section>
<section id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline"></a></h2>
<p>Check out the <a class="reference internal" href="../examples/index.html"><span class="doc">Twisted Names Examples</span></a> which demonstrate how the client APIs can be used to create useful DNS diagnostic tools.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Developer Guides" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="names.html" class="btn btn-neutral float-right" title="Creating and working with a names (DNS) server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Twisted Matrix Labs. Ver 22.8.0.post0. Built on 2022-09-16.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>